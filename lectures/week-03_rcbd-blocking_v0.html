<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-99.9.9">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Davood Tofighi, Ph.D.">

<title>Randomized Complete Block Design (RCBD) with Blocking – STAT 454/545 - Analysis of Variance and Experimental Design</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-41fbfa16b5e39347becdc9f3c4e28729.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-aff2639e191a0a8d05f4f3608923e904.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<link href="../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<meta property="og:title" content="Randomized Complete Block Design (RCBD) with Blocking – STAT 454/545 - Analysis of Variance and Experimental Design">
<meta property="og:description" content="Analysis of Variance and Experimental Design">
<meta property="og:image" content="https://Data-Wise.github.io/doe/lectures/assets/images/home.png">
<meta property="og:site_name" content="STAT 454/545 - Analysis of Variance and Experimental Design">
</head><body class="nav-fixed"><img src="../assets/images/home.png" alt="Course Banner" style="width: 100%; height: auto;">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&amp;family=Montserrat:wght@400;700&amp;family=Fira+Code:wght@400;700&amp;display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../assets/styles/css/home.css">




<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">STAT 454/545 - Analysis of Variance and Experimental Design</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus/syllabus-final.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_lectures.html"> 
<span class="menu-text">Lecture Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus/schedule.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_assignments.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../contents.html"> 
<span class="menu-text">Contents</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Randomized Complete Block Design (RCBD) with Blocking</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Davood Tofighi, Ph.D. </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">25-Dec-2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="-1">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  </ul></li>
  <li><a href="#objectives" id="toc-objectives" class="nav-link" data-scroll-target="#objectives">Objectives</a></li>
  <li><a href="#complete-block-designs-theory-and-structure" id="toc-complete-block-designs-theory-and-structure" class="nav-link" data-scroll-target="#complete-block-designs-theory-and-structure">Complete Block Designs: Theory and Structure</a>
  <ul class="collapse">
  <li><a href="#what-are-complete-block-designs" id="toc-what-are-complete-block-designs" class="nav-link" data-scroll-target="#what-are-complete-block-designs">What Are Complete Block Designs?</a>
  <ul class="collapse">
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1">Example</a></li>
  </ul></li>
  <li><a href="#randomized-complete-block-designs-rcbds" id="toc-randomized-complete-block-designs-rcbds" class="nav-link" data-scroll-target="#randomized-complete-block-designs-rcbds">Randomized Complete Block Designs (RCBDs)</a></li>
  <li><a href="#general-complete-block-designs" id="toc-general-complete-block-designs" class="nav-link" data-scroll-target="#general-complete-block-designs">General Complete Block Designs</a></li>
  </ul></li>
  <li><a href="#analysis-of-rcbds" id="toc-analysis-of-rcbds" class="nav-link" data-scroll-target="#analysis-of-rcbds">Analysis of RCBDs</a>
  <ul class="collapse">
  <li><a href="#model-and-assumptions" id="toc-model-and-assumptions" class="nav-link" data-scroll-target="#model-and-assumptions">Model and Assumptions</a></li>
  <li><a href="#key-assumptions" id="toc-key-assumptions" class="nav-link" data-scroll-target="#key-assumptions">Key Assumptions</a></li>
  <li><a href="#anova-for-rcbds" id="toc-anova-for-rcbds" class="nav-link" data-scroll-target="#anova-for-rcbds">ANOVA for RCBDs</a>
  <ul class="collapse">
  <li><a href="#variance-decomposition" id="toc-variance-decomposition" class="nav-link" data-scroll-target="#variance-decomposition">Variance Decomposition</a></li>
  <li><a href="#anova-table" id="toc-anova-table" class="nav-link" data-scroll-target="#anova-table">ANOVA Table</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#implementation-in-r" id="toc-implementation-in-r" class="nav-link" data-scroll-target="#implementation-in-r">Implementation in R</a>
  <ul class="collapse">
  <li><a href="#example-bread-baking-experiment" id="toc-example-bread-baking-experiment" class="nav-link" data-scroll-target="#example-bread-baking-experiment">Example: Bread-Baking Experiment</a>
  <ul class="collapse">
  <li><a href="#scenario" id="toc-scenario" class="nav-link" data-scroll-target="#scenario">Scenario</a></li>
  <li><a href="#step-by-step-r-code" id="toc-step-by-step-r-code" class="nav-link" data-scroll-target="#step-by-step-r-code">Step-by-Step R Code</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#advanced-topics" id="toc-advanced-topics" class="nav-link" data-scroll-target="#advanced-topics">Advanced Topics</a>
  <ul class="collapse">
  <li><a href="#general-complete-block-designs-1" id="toc-general-complete-block-designs-1" class="nav-link" data-scroll-target="#general-complete-block-designs-1">General Complete Block Designs</a>
  <ul class="collapse">
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a></li>
  <li><a href="#sample-size-calculations" id="toc-sample-size-calculations" class="nav-link" data-scroll-target="#sample-size-calculations">Sample Size Calculations</a></li>
  </ul></li>
  <li><a href="#handling-block-treatment-interactions" id="toc-handling-block-treatment-interactions" class="nav-link" data-scroll-target="#handling-block-treatment-interactions">Handling Block-Treatment Interactions</a>
  <ul class="collapse">
  <li><a href="#model-with-interaction" id="toc-model-with-interaction" class="nav-link" data-scroll-target="#model-with-interaction">Model with Interaction</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#practical-applications" id="toc-practical-applications" class="nav-link" data-scroll-target="#practical-applications">Practical Applications</a>
  <ul class="collapse">
  <li><a href="#example-resting-metabolic-rate" id="toc-example-resting-metabolic-rate" class="nav-link" data-scroll-target="#example-resting-metabolic-rate">Example: Resting Metabolic Rate</a>
  <ul class="collapse">
  <li><a href="#scenario-1" id="toc-scenario-1" class="nav-link" data-scroll-target="#scenario-1">Scenario</a></li>
  <li><a href="#step-by-step-r-code-1" id="toc-step-by-step-r-code-1" class="nav-link" data-scroll-target="#step-by-step-r-code-1">Step-by-Step R Code</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways">Key Takeaways</a></li>
  </ul></li>
  <li><a href="#appendix-advanced-mathematical-derivations" id="toc-appendix-advanced-mathematical-derivations" class="nav-link" data-scroll-target="#appendix-advanced-mathematical-derivations">Appendix: Advanced Mathematical Derivations</a>
  <ul class="collapse">
  <li><a href="#proof-of-rcbd-model-assumptions" id="toc-proof-of-rcbd-model-assumptions" class="nav-link" data-scroll-target="#proof-of-rcbd-model-assumptions">Proof of RCBD Model Assumptions</a>
  <ul class="collapse">
  <li><a href="#variance-decomposition-1" id="toc-variance-decomposition-1" class="nav-link" data-scroll-target="#variance-decomposition-1">1. Variance Decomposition</a></li>
  <li><a href="#assumptions" id="toc-assumptions" class="nav-link" data-scroll-target="#assumptions">Assumptions</a></li>
  <li><a href="#variance-decomposition-2" id="toc-variance-decomposition-2" class="nav-link" data-scroll-target="#variance-decomposition-2">Variance Decomposition</a></li>
  <li><a href="#derivation" id="toc-derivation" class="nav-link" data-scroll-target="#derivation">Derivation</a></li>
  </ul></li>
  <li><a href="#effects-of-ignoring-block-treatment-interaction" id="toc-effects-of-ignoring-block-treatment-interaction" class="nav-link" data-scroll-target="#effects-of-ignoring-block-treatment-interaction">Effects of Ignoring Block-Treatment Interaction</a>
  <ul class="collapse">
  <li><a href="#mathematical-illustration" id="toc-mathematical-illustration" class="nav-link" data-scroll-target="#mathematical-illustration">Mathematical Illustration</a></li>
  <li><a href="#proof-outline" id="toc-proof-outline" class="nav-link" data-scroll-target="#proof-outline">Proof Outline</a></li>
  </ul></li>
  <li><a href="#sample-size-calculations-for-rcbds" id="toc-sample-size-calculations-for-rcbds" class="nav-link" data-scroll-target="#sample-size-calculations-for-rcbds">Sample Size Calculations for RCBDs</a>
  <ul class="collapse">
  <li><a href="#formula" id="toc-formula" class="nav-link" data-scroll-target="#formula">Formula</a></li>
  <li><a href="#derivation-1" id="toc-derivation-1" class="nav-link" data-scroll-target="#derivation-1">Derivation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul class="collapse">
  <li><a href="#medium-difficulty" id="toc-medium-difficulty" class="nav-link" data-scroll-target="#medium-difficulty">Medium Difficulty</a></li>
  <li><a href="#challenging-problems" id="toc-challenging-problems" class="nav-link" data-scroll-target="#challenging-problems">Challenging Problems</a></li>
  <li><a href="#discussion-points" id="toc-discussion-points" class="nav-link" data-scroll-target="#discussion-points">Discussion Points</a></li>
  <li><a href="#r-code-example" id="toc-r-code-example" class="nav-link" data-scroll-target="#r-code-example">R Code Example</a></li>
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation">Interpretation</a></li>
  <li><a href="#proof-outline-1" id="toc-proof-outline-1" class="nav-link" data-scroll-target="#proof-outline-1">Proof Outline</a></li>
  </ul></li>
  <li><a href="#appendix-advanced-mathematical-derivations-1" id="toc-appendix-advanced-mathematical-derivations-1" class="nav-link" data-scroll-target="#appendix-advanced-mathematical-derivations-1">Appendix: Advanced Mathematical Derivations</a>
  <ul class="collapse">
  <li><a href="#proof-of-rcbd-model-assumptions-1" id="toc-proof-of-rcbd-model-assumptions-1" class="nav-link" data-scroll-target="#proof-of-rcbd-model-assumptions-1">Proof of RCBD Model Assumptions</a>
  <ul class="collapse">
  <li><a href="#variance-decomposition-3" id="toc-variance-decomposition-3" class="nav-link" data-scroll-target="#variance-decomposition-3">1. Variance Decomposition</a></li>
  <li><a href="#effects-of-ignoring-block-treatment-interaction-1" id="toc-effects-of-ignoring-block-treatment-interaction-1" class="nav-link" data-scroll-target="#effects-of-ignoring-block-treatment-interaction-1">2. Effects of Ignoring Block-Treatment Interaction</a></li>
  </ul></li>
  <li><a href="#sample-size-calculations-for-rcbds-1" id="toc-sample-size-calculations-for-rcbds-1" class="nav-link" data-scroll-target="#sample-size-calculations-for-rcbds-1">Sample Size Calculations for RCBDs</a>
  <ul class="collapse">
  <li><a href="#formula-1" id="toc-formula-1" class="nav-link" data-scroll-target="#formula-1">Formula</a></li>
  <li><a href="#derivation-2" id="toc-derivation-2" class="nav-link" data-scroll-target="#derivation-2">Derivation</a></li>
  </ul></li>
  <li><a href="#handling-block-treatment-interactions-1" id="toc-handling-block-treatment-interactions-1" class="nav-link" data-scroll-target="#handling-block-treatment-interactions-1">Handling Block-Treatment Interactions</a>
  <ul class="collapse">
  <li><a href="#model-with-interaction-1" id="toc-model-with-interaction-1" class="nav-link" data-scroll-target="#model-with-interaction-1">Model with Interaction</a></li>
  </ul></li>
  <li><a href="#sample-size-calculation-example-in-r" id="toc-sample-size-calculation-example-in-r" class="nav-link" data-scroll-target="#sample-size-calculation-example-in-r">Sample Size Calculation Example in R</a></li>
  </ul></li>
  <li><a href="#exercises-1" id="toc-exercises-1" class="nav-link" data-scroll-target="#exercises-1">Exercises</a>
  <ul class="collapse">
  <li><a href="#medium-difficulty-1" id="toc-medium-difficulty-1" class="nav-link" data-scroll-target="#medium-difficulty-1">Medium Difficulty</a>
  <ul class="collapse">
  <li><a href="#r-code-example-1" id="toc-r-code-example-1" class="nav-link" data-scroll-target="#r-code-example-1">R Code Example</a></li>
  </ul></li>
  <li><a href="#challenging-problems-1" id="toc-challenging-problems-1" class="nav-link" data-scroll-target="#challenging-problems-1">Challenging Problems</a>
  <ul class="collapse">
  <li><a href="#r-code-example-2" id="toc-r-code-example-2" class="nav-link" data-scroll-target="#r-code-example-2">R Code Example</a></li>
  </ul></li>
  <li><a href="#discussion-points-1" id="toc-discussion-points-1" class="nav-link" data-scroll-target="#discussion-points-1">Discussion Points:</a>
  <ul class="collapse">
  <li><a href="#r-code-example-3" id="toc-r-code-example-3" class="nav-link" data-scroll-target="#r-code-example-3">R Code Example:</a></li>
  </ul></li>
  <li><a href="#interpretation-1" id="toc-interpretation-1" class="nav-link" data-scroll-target="#interpretation-1">Interpretation</a></li>
  <li><a href="#proof-outline-2" id="toc-proof-outline-2" class="nav-link" data-scroll-target="#proof-outline-2">Proof Outline:</a></li>
  </ul></li>
  <li><a href="#appendix-advanced-mathematical-derivations-2" id="toc-appendix-advanced-mathematical-derivations-2" class="nav-link" data-scroll-target="#appendix-advanced-mathematical-derivations-2">Appendix: Advanced Mathematical Derivations</a>
  <ul class="collapse">
  <li><a href="#adjusted-treatment-means" id="toc-adjusted-treatment-means" class="nav-link" data-scroll-target="#adjusted-treatment-means">Adjusted Treatment Means</a></li>
  <li><a href="#derivation-3" id="toc-derivation-3" class="nav-link" data-scroll-target="#derivation-3">Derivation</a>
  <ul class="collapse">
  <li><a href="#f-test-for-homogeneity-of-slopes" id="toc-f-test-for-homogeneity-of-slopes" class="nav-link" data-scroll-target="#f-test-for-homogeneity-of-slopes">F-Test for Homogeneity of Slopes</a></li>
  <li><a href="#model-comparison" id="toc-model-comparison" class="nav-link" data-scroll-target="#model-comparison">Model Comparison</a></li>
  <li><a href="#hypothesis-testing" id="toc-hypothesis-testing" class="nav-link" data-scroll-target="#hypothesis-testing">Hypothesis Testing</a></li>
  <li><a href="#test-statistic" id="toc-test-statistic" class="nav-link" data-scroll-target="#test-statistic">Test Statistic</a></li>
  </ul></li>
  <li><a href="#confidence-intervals-for-higher-order-contrasts" id="toc-confidence-intervals-for-higher-order-contrasts" class="nav-link" data-scroll-target="#confidence-intervals-for-higher-order-contrasts">Confidence Intervals for Higher-Order Contrasts</a>
  <ul class="collapse">
  <li><a href="#formula-2" id="toc-formula-2" class="nav-link" data-scroll-target="#formula-2">Formula</a></li>
  <li><a href="#steps-in-r" id="toc-steps-in-r" class="nav-link" data-scroll-target="#steps-in-r">Steps in R</a></li>
  <li><a href="#example-2" id="toc-example-2" class="nav-link" data-scroll-target="#example-2">Example:</a></li>
  <li><a href="#interpretation-2" id="toc-interpretation-2" class="nav-link" data-scroll-target="#interpretation-2">Interpretation:</a></li>
  </ul></li>
  <li><a href="#conclusion-1" id="toc-conclusion-1" class="nav-link" data-scroll-target="#conclusion-1">Conclusion</a></li>
  <li><a href="#key-takeaways-1" id="toc-key-takeaways-1" class="nav-link" data-scroll-target="#key-takeaways-1">Key Takeaways</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In the realm of experimental design, <strong>Complete Block Designs (CBDs)</strong> play a pivotal role in controlling the effects of nuisance factors, thereby enhancing the precision of treatment comparisons. By organizing experimental units into blocks that share similar characteristics, CBDs effectively reduce variability stemming from these extraneous factors. This structured approach not only refines the efficiency of experiments but also ensures more accurate and reliable analyses.</p>
<section id="example" class="level3">
<h3 class="anchored" data-anchor-id="example">Example</h3>
<p>Imagine you are testing different fertilizers on crops spread across a large farm. The farm has sections with varying soil types, sunlight exposure, and moisture levels. Without controlling for these variations, it would be challenging to discern the true effect of each fertilizer. By grouping plots with similar soil types into blocks, you can more precisely compare the performance of fertilizers within each homogeneous group, minimizing the confounding influence of soil variability.</p>
<p>This lecture delves into the structure, applications, and analysis of Complete Block Designs, with a focus on <strong>Randomized Complete Block Designs (RCBDs)</strong> and their generalizations. We will explore theoretical underpinnings, practical implementations using R, and advanced topics to provide a comprehensive understanding tailored for graduate statistics students.</p>
</section>
</section>
<section id="objectives" class="level2">
<h2 class="anchored" data-anchor-id="objectives">Objectives</h2>
<ol type="1">
<li><strong>Define and distinguish</strong> between complete and incomplete block designs.</li>
<li><strong>Explore</strong> the structure and application of Randomized Complete Block Designs (RCBDs).</li>
<li><strong>Perform</strong> Analysis of Variance (ANOVA) for RCBDs and assess the efficiency of blocking.</li>
<li><strong>Understand</strong> general complete block designs and their applications.</li>
<li><strong>Implement</strong> complete block designs in R and interpret the results.</li>
<li><strong>Reinforce</strong> concepts with exercises covering numerical examples, conceptual understanding, and mathematical proofs.</li>
<li><strong>Explore</strong> advanced mathematical derivations and proofs in the Appendix.</li>
</ol>
</section>
<section id="complete-block-designs-theory-and-structure" class="level1">
<h1>Complete Block Designs: Theory and Structure</h1>
<section id="what-are-complete-block-designs" class="level2">
<h2 class="anchored" data-anchor-id="what-are-complete-block-designs">What Are Complete Block Designs?</h2>
<p><strong>Complete Block Designs (CBDs)</strong> are experimental designs where each block contains all the treatments being tested. This ensures that every treatment is applied in each block, allowing for direct comparisons under similar conditions.</p>
<ul>
<li><strong>Block:</strong> A group of experimental units that are similar in some aspect and expected to yield comparable responses.</li>
<li><strong>Complete Block:</strong> Each block includes every treatment exactly once.</li>
</ul>
<section id="example-1" class="level3">
<h3 class="anchored" data-anchor-id="example-1">Example</h3>
<p>In a clinical trial comparing drug treatments across different hospitals, each hospital represents a block. By administering all treatments in each hospital, you account for hospital-specific factors, such as patient demographics and care protocols, ensuring that treatment effects are evaluated consistently.</p>
</section>
</section>
<section id="randomized-complete-block-designs-rcbds" class="level2">
<h2 class="anchored" data-anchor-id="randomized-complete-block-designs-rcbds">Randomized Complete Block Designs (RCBDs)</h2>
<p><strong>RCBDs</strong> are a specific type of CBD where treatments are randomly assigned within each block. This randomness ensures that the assignment of treatments is free from bias and that any differences observed are attributable to the treatments rather than systematic variations.</p>
<p><strong>Characteristics of RCBDs:</strong></p>
<ul>
<li>The number of experimental units in each block equals the number of treatments.</li>
<li>Each treatment appears exactly once per block.</li>
<li>Treatments are assigned randomly within each block.</li>
</ul>
<p><strong>Analogy:</strong> Think of RCBDs as seating arrangements in a classroom where each row (block) must contain one student from each house (treatments). By randomly assigning students to seats within rows, you ensure that no particular house has an advantage in any row.</p>
</section>
<section id="general-complete-block-designs" class="level2">
<h2 class="anchored" data-anchor-id="general-complete-block-designs">General Complete Block Designs</h2>
<p>Beyond RCBDs, <strong>General Complete Block Designs</strong> allow for multiple observations or replicates of treatments within each block. This is particularly useful when interaction effects between treatments and blocks are anticipated.</p>
<p><strong>Features:</strong></p>
<ul>
<li>A treatment is replicated <span class="math inline">\(s &gt; 1\)</span> times within a block.</li>
<li>Facilitates the detection of interactions between treatments and blocking factors.</li>
</ul>
<p><strong>Example:</strong> In a clinical trial, if a treatment needs to be administered multiple times within each hospital ward (block) to account for ward-specific factors, a general complete block design would be appropriate.</p>
</section>
</section>
<section id="analysis-of-rcbds" class="level1">
<h1>Analysis of RCBDs</h1>
<section id="model-and-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="model-and-assumptions">Model and Assumptions</h2>
<p>The statistical model for an RCBD can be expressed as:</p>
<p><span class="math display">\[
Y_{hi} = \mu + \theta_h + \tau_i + \epsilon_{hi}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(Y_{hi}\)</span>: Response variable for treatment <span class="math inline">\(i\)</span> in block <span class="math inline">\(h\)</span>.</li>
<li><span class="math inline">\(\mu\)</span>: Overall mean.</li>
<li><span class="math inline">\(\theta_h\)</span>: Effect of block <span class="math inline">\(h\)</span>.</li>
<li><span class="math inline">\(\tau_i\)</span>: Effect of treatment <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(\epsilon_{hi} \sim N(0, \sigma^2)\)</span>: Random error term.</li>
</ul>
</section>
<section id="key-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="key-assumptions">Key Assumptions</h2>
<ol type="1">
<li><strong>Normality:</strong> The residuals (<span class="math inline">\(\epsilon_{hi}\)</span>) are normally distributed.</li>
<li><strong>Homogeneity of Variance (Homoscedasticity):</strong> The variance of residuals is constant across all treatments and blocks.</li>
<li><strong>Independence:</strong> Observations are independent of each other.</li>
<li><strong>No Interaction:</strong> There is no interaction between blocks and treatments, i.e., the effect of a treatment is consistent across all blocks.</li>
</ol>
<p><strong>Deeper Insight:</strong> Assumption of no interaction is critical. If this assumption is violated, the RCBD model may not adequately capture the variability, leading to biased estimates of treatment effects. In such cases, more complex designs that account for interactions, like general complete block designs, are necessary.</p>
<p><strong>Reference:</strong> Kempthorne (1977) elaborates on the assumptions and their implications in <em>Design and Analysis of Experiments</em>.</p>
</section>
<section id="anova-for-rcbds" class="level2">
<h2 class="anchored" data-anchor-id="anova-for-rcbds">ANOVA for RCBDs</h2>
<p>To analyze RCBDs, we employ <strong>Analysis of Variance (ANOVA)</strong>, which decomposes the total variability in the data into components attributable to blocks, treatments, and random error.</p>
<section id="variance-decomposition" class="level3">
<h3 class="anchored" data-anchor-id="variance-decomposition">Variance Decomposition</h3>
<p><span class="math display">\[
\text{Total SS} = \text{Block SS} + \text{Treatment SS} + \text{Error SS}
\]</span></p>
</section>
<section id="anova-table" class="level3">
<h3 class="anchored" data-anchor-id="anova-table">ANOVA Table</h3>
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 14%">
<col style="width: 13%">
<col style="width: 32%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th>Source of Variation</th>
<th>Degrees of Freedom (DF)</th>
<th>Sum of Squares (SS)</th>
<th>Mean Square (MS)</th>
<th>F-ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Blocks</td>
<td><span class="math inline">\(b - 1\)</span></td>
<td><span class="math inline">\(SS_\text{Block}\)</span></td>
<td><span class="math inline">\(MS_\text{Block} = SS_\text{Block} / (b-1)\)</span></td>
<td></td>
</tr>
<tr class="even">
<td>Treatments</td>
<td><span class="math inline">\(t - 1\)</span></td>
<td><span class="math inline">\(SS_\text{Treatment}\)</span></td>
<td><span class="math inline">\(MS_\text{Treatment} = SS_\text{Treatment} / (t-1)\)</span></td>
<td><span class="math inline">\(\frac{MS_\text{Treatment}}{MS_\text{Error}}\)</span></td>
</tr>
<tr class="odd">
<td>Error</td>
<td><span class="math inline">\((b-1)(t-1)\)</span></td>
<td><span class="math inline">\(SS_\text{Error}\)</span></td>
<td><span class="math inline">\(MS_\text{Error} = SS_\text{Error} / ((b-1)(t-1))\)</span></td>
<td></td>
</tr>
<tr class="even">
<td><strong>Total</strong></td>
<td><span class="math inline">\(bt - 1\)</span></td>
<td><span class="math inline">\(SS_\text{Total}\)</span></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><strong>Hypothesis Testing:</strong>
<ul>
<li><strong>Null Hypothesis (<span class="math inline">\(H_0\)</span>):</strong> All treatment means are equal (<span class="math inline">\(\tau_i = 0\)</span> for all <span class="math inline">\(i\)</span>).</li>
<li><strong>Alternative Hypothesis (<span class="math inline">\(H_A\)</span>):</strong> At least one treatment mean is different.</li>
</ul></li>
<li><strong>Decision Rule:</strong> Reject <span class="math inline">\(H_0\)</span> if the F-ratio exceeds the critical value from the F-distribution with degrees of freedom <span class="math inline">\((t-1, (b-1)(t-1))\)</span> at the chosen significance level (<span class="math inline">\(\alpha\)</span>).</li>
</ul>
<p><strong>Intuitive Explanation:</strong> The F-ratio compares the variability due to treatments to the variability due to random error. A higher F-ratio indicates that treatments explain a significant portion of the variability in responses, suggesting that treatment effects are meaningful.</p>
</section>
</section>
</section>
<section id="implementation-in-r" class="level1">
<h1>Implementation in R</h1>
<section id="example-bread-baking-experiment" class="level2">
<h2 class="anchored" data-anchor-id="example-bread-baking-experiment">Example: Bread-Baking Experiment</h2>
<section id="scenario" class="level3">
<h3 class="anchored" data-anchor-id="scenario">Scenario</h3>
<p>An experimenter aims to compare four bread recipes (treatments) across three oven shelves (blocks). Each shelf is expected to have similar conditions, making it an ideal blocking factor.</p>
</section>
<section id="step-by-step-r-code" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-r-code">Step-by-Step R Code</h3>
<section id="load-data-and-prepare-factors" class="level4">
<h4 class="anchored" data-anchor-id="load-data-and-prepare-factors">1. Load Data and Prepare Factors</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define blocks and treatments</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>blocks <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">each =</span> <span class="dv">4</span>))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">times =</span> <span class="dv">3</span>))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate response variable (e.g., loaf weight in grams)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnorm</span>(<span class="dv">4</span>, <span class="at">mean =</span> <span class="dv">500</span>, <span class="at">sd =</span> <span class="dv">10</span>), <span class="co"># Block 1</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnorm</span>(<span class="dv">4</span>, <span class="at">mean =</span> <span class="dv">505</span>, <span class="at">sd =</span> <span class="dv">10</span>), <span class="co"># Block 2</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnorm</span>(<span class="dv">4</span>, <span class="at">mean =</span> <span class="dv">498</span>, <span class="at">sd =</span> <span class="dv">10</span>) <span class="co"># Block 3</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(blocks, treatments, response)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># View the data</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Output Interpretation:</strong> The dataset comprises three blocks, each containing all four treatments. The response variable represents the loaf weight, simulated with slight block-specific means to reflect potential block effects.</p>
</section>
<section id="fit-the-rcbd-model" class="level4">
<h4 class="anchored" data-anchor-id="fit-the-rcbd-model">2. Fit the RCBD Model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the RCBD model using ANOVA</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">aov</span>(response <span class="sc">~</span> blocks <span class="sc">+</span> treatments, <span class="at">data =</span> data)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of the model</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation:</strong></p>
<ul>
<li><strong>Blocks:</strong> Capture the variability due to different oven shelves.</li>
<li><strong>Treatments:</strong> Assess the effect of different bread recipes after accounting for block effects.</li>
<li><strong>Error:</strong> Represents unexplained variability.</li>
</ul>
</section>
<section id="assess-blocking-efficiency" class="level4">
<h4 class="anchored" data-anchor-id="assess-blocking-efficiency">3. Assess Blocking Efficiency</h4>
<p>Compare the Mean Square for Blocks (<span class="math inline">\(MS_\text{Block}\)</span>) with Mean Square for Error (<span class="math inline">\(MS_\text{Error}\)</span>). A higher <span class="math inline">\(MS_\text{Block}\)</span> indicates substantial block effects, enhancing the precision of treatment comparisons.</p>
</section>
<section id="diagnostic-plots" class="level4">
<h4 class="anchored" data-anchor-id="diagnostic-plots">4. Diagnostic Plots</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostic plots for the ANOVA model</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation:</strong></p>
<ul>
<li><strong>Residuals vs Fitted:</strong> Check for homoscedasticity and non-linearity.</li>
<li><strong>Normal Q-Q:</strong> Assess normality of residuals.</li>
<li><strong>Scale-Location:</strong> Evaluate homogeneity of variance.</li>
<li><strong>Residuals vs Leverage:</strong> Identify influential observations.</li>
</ul>
</section>
<section id="multiple-comparisons-post-hoc-analysis" class="level4">
<h4 class="anchored" data-anchor-id="multiple-comparisons-post-hoc-analysis">5. Multiple Comparisons (Post-Hoc Analysis)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load emmeans package for estimated marginal means</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated marginal means for treatments</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(model, <span class="sc">~</span>treatments)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Pairwise comparisons</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>pairwise_comparisons <span class="ot">&lt;-</span> <span class="fu">contrast</span>(emm, <span class="at">method =</span> <span class="st">"pairwise"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pairwise_comparisons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation:</strong> Identify which bread recipes significantly differ in loaf weight after adjusting for oven shelf effects.</p>
</section>
</section>
</section>
</section>
<section id="advanced-topics" class="level1">
<h1>Advanced Topics</h1>
<section id="general-complete-block-designs-1" class="level2">
<h2 class="anchored" data-anchor-id="general-complete-block-designs-1">General Complete Block Designs</h2>
<section id="model" class="level3">
<h3 class="anchored" data-anchor-id="model">Model</h3>
<p>For designs where treatments are replicated within blocks, the model extends to include interaction effects:</p>
<p><span class="math display">\[
Y_{hit} = \mu + \theta_h + \tau_i + (\theta \tau)^*_{hi} + \epsilon^*_{hit}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(Y_{hit}\)</span>: Response for treatment <span class="math inline">\(i\)</span> in block <span class="math inline">\(h\)</span>, replicate <span class="math inline">\(t\)</span>.</li>
<li><span class="math inline">\(\theta_h\)</span>: Effect of block <span class="math inline">\(h\)</span>.</li>
<li><span class="math inline">\(\tau_i\)</span>: Effect of treatment <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\((\theta \tau)_{hi}\)</span>: Interaction effect between block <span class="math inline">\(h\)</span> and treatment <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(\epsilon_{hit}\)</span>: Random error.</li>
</ul>
</section>
<section id="sample-size-calculations" class="level3">
<h3 class="anchored" data-anchor-id="sample-size-calculations">Sample Size Calculations</h3>
<p>Determining the appropriate sample size is crucial for ensuring adequate power in detecting treatment effects.</p>
<p><span class="math display">\[
n \geq \frac{2 v \sigma^2 \phi^2}{b \Delta^2}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(n\)</span>: Number of replicates per treatment.</li>
<li><span class="math inline">\(v\)</span>: Number of treatments.</li>
<li><span class="math inline">\(\sigma^2\)</span>: Variance estimate.</li>
<li><span class="math inline">\(\phi\)</span>: Desired power.</li>
<li><span class="math inline">\(b\)</span>: Number of blocks.</li>
<li><span class="math inline">\(\Delta\)</span>: Minimum detectable effect size.</li>
</ul>
<p><strong>Deeper Insight:</strong> Sample size calculations consider the balance between desired statistical power and the practical constraints of the experiment. Increasing the number of blocks or replicates can enhance the power but may require more resources.</p>
</section>
</section>
<section id="handling-block-treatment-interactions" class="level2">
<h2 class="anchored" data-anchor-id="handling-block-treatment-interactions">Handling Block-Treatment Interactions</h2>
<p>In scenarios where interaction effects are suspected, it’s essential to include them in the model to avoid biased estimates.</p>
<section id="model-with-interaction" class="level3">
<h3 class="anchored" data-anchor-id="model-with-interaction">Model with Interaction</h3>
<p><span class="math display">\[
Y_{hit} = \mu + \theta_h + \tau_i + (\theta \tau)^*_{hi} + \epsilon^*_{hit}
\]</span></p>
<p><strong>Implications:</strong></p>
<ul>
<li><strong>Significant Interaction:</strong> Indicates that the effect of treatments varies across blocks, necessitating separate treatment effect analyses within each block.</li>
<li><strong>Non-Significant Interaction:</strong> Supports the additive model, validating the use of standard RCBD analysis.</li>
</ul>
</section>
</section>
</section>
<section id="practical-applications" class="level1">
<h1>Practical Applications</h1>
<section id="example-resting-metabolic-rate" class="level2">
<h2 class="anchored" data-anchor-id="example-resting-metabolic-rate">Example: Resting Metabolic Rate</h2>
<section id="scenario-1" class="level3">
<h3 class="anchored" data-anchor-id="scenario-1">Scenario</h3>
<p>A study aims to compare three different exercise protocols (Treatments A, B, C) on subjects’ resting metabolic rates. The subjects are grouped into four blocks based on age groups to control for age-related variability.</p>
</section>
<section id="step-by-step-r-code-1" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-r-code-1">Step-by-Step R Code</h3>
<section id="load-and-prepare-data" class="level4">
<h4 class="anchored" data-anchor-id="load-and-prepare-data">1. Load and Prepare Data</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define blocks and treatments</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>blocks <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">each =</span> <span class="dv">3</span>))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>), <span class="at">times =</span> <span class="dv">4</span>))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate response variable (e.g., resting metabolic rate in kcal/day)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnorm</span>(<span class="dv">3</span>, <span class="at">mean =</span> <span class="dv">1500</span>, <span class="at">sd =</span> <span class="dv">50</span>), <span class="co"># Block 1</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnorm</span>(<span class="dv">3</span>, <span class="at">mean =</span> <span class="dv">1550</span>, <span class="at">sd =</span> <span class="dv">50</span>), <span class="co"># Block 2</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnorm</span>(<span class="dv">3</span>, <span class="at">mean =</span> <span class="dv">1480</span>, <span class="at">sd =</span> <span class="dv">50</span>), <span class="co"># Block 3</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnorm</span>(<span class="dv">3</span>, <span class="at">mean =</span> <span class="dv">1520</span>, <span class="at">sd =</span> <span class="dv">50</span>) <span class="co"># Block 4</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(blocks, treatments, response)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co"># View the data</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fit-the-rcbd-model-1" class="level4">
<h4 class="anchored" data-anchor-id="fit-the-rcbd-model-1">2. Fit the RCBD Model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the RCBD model using ANOVA</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">aov</span>(response <span class="sc">~</span> blocks <span class="sc">+</span> treatments, <span class="at">data =</span> data)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of the model</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation:</strong></p>
<ul>
<li><strong>Blocks:</strong> Account for age-related variability.</li>
<li><strong>Treatments:</strong> Assess the impact of exercise protocols on metabolic rate after controlling for age.</li>
</ul>
</section>
<section id="diagnostic-plots-1" class="level4">
<h4 class="anchored" data-anchor-id="diagnostic-plots-1">3. Diagnostic Plots</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostic plots for the ANOVA model</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation:</strong> Ensure that residuals meet ANOVA assumptions. Look for random scatter in Residuals vs Fitted, linearity in Scale-Location, and normality in Q-Q plots.</p>
</section>
<section id="post-hoc-analysis" class="level4">
<h4 class="anchored" data-anchor-id="post-hoc-analysis">4. Post-Hoc Analysis</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load emmeans package for estimated marginal means</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated marginal means for treatments</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(model, <span class="sc">~</span>treatments)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Pairwise comparisons</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>pairwise_comparisons <span class="ot">&lt;-</span> <span class="fu">contrast</span>(emm, <span class="at">method =</span> <span class="st">"pairwise"</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pairwise_comparisons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation:</strong> Determine which exercise protocols significantly differ in their effect on resting metabolic rates after adjusting for age.</p>
</section>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p><strong>Complete Block Designs (CBDs)</strong>, particularly <strong>Randomized Complete Block Designs (RCBDs)</strong>, are indispensable in experimental research for controlling variability due to nuisance factors. By structuring experiments to include blocks where each treatment is represented, CBDs enhance the precision and reliability of treatment effect estimates. The integration of ANOVA facilitates robust analysis, allowing researchers to discern meaningful differences among treatments while accounting for block-induced variability.</p>
</section>
<section id="key-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="key-takeaways">Key Takeaways</h2>
<ul>
<li><strong>Blocking:</strong> Reduces variability from known sources, increasing the efficiency of treatment comparisons.</li>
<li><strong>ANOVA in RCBDs:</strong> Decomposes variability to isolate treatment effects, providing a clear framework for hypothesis testing.</li>
<li><strong>General Complete Block Designs:</strong> Extend the utility of CBDs to more complex scenarios involving treatment replications within blocks.</li>
<li><strong>Practical Implementation:</strong> R offers comprehensive tools for designing, analyzing, and interpreting CBDs, empowering researchers with robust statistical capabilities.</li>
<li><strong>Advanced Topics:</strong> Understanding interactions and sample size considerations enhances the depth and applicability of CBDs in diverse research contexts.</li>
</ul>
<p>Mastery of Complete Block Designs equips graduate students with the methodological rigor necessary for conducting sophisticated experiments, ensuring that findings are both accurate and generalizable.</p>
</section>
</section>
<section id="appendix-advanced-mathematical-derivations" class="level1">
<h1>Appendix: Advanced Mathematical Derivations</h1>
<section id="proof-of-rcbd-model-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="proof-of-rcbd-model-assumptions">Proof of RCBD Model Assumptions</h2>
<section id="variance-decomposition-1" class="level3">
<h3 class="anchored" data-anchor-id="variance-decomposition-1">1. Variance Decomposition</h3>
<p>The RCBD model is expressed as:</p>
<p><span class="math display">\[
Y_{hi} = \mu + \theta_h + \tau_i + \epsilon_{hi}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(Y_{hi}\)</span>: Response for treatment <span class="math inline">\(i\)</span> in block <span class="math inline">\(h\)</span>.</li>
<li><span class="math inline">\(\mu\)</span>: Overall mean.</li>
<li><span class="math inline">\(\theta_h\)</span>: Effect of block <span class="math inline">\(h\)</span>.</li>
<li><span class="math inline">\(\tau_i\)</span>: Effect of treatment <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(\epsilon_{hi} \sim N(0, \sigma^2)\)</span>: Error term.</li>
</ul>
</section>
<section id="assumptions" class="level3">
<h3 class="anchored" data-anchor-id="assumptions">Assumptions</h3>
<ol type="1">
<li><strong>Normality:</strong> <span class="math inline">\(\epsilon_{hi}\)</span> are normally distributed.</li>
<li><strong>Independence:</strong> Observations are independent.</li>
<li><strong>Homoscedasticity:</strong> <span class="math inline">\(\sigma^2\)</span> is constant across all treatments and blocks.</li>
<li><strong>No Interaction:</strong> Effects of blocks and treatments are additive.</li>
</ol>
</section>
<section id="variance-decomposition-2" class="level3">
<h3 class="anchored" data-anchor-id="variance-decomposition-2">Variance Decomposition</h3>
<p><span class="math display">\[
\text{Total SS} = \text{Block SS} + \text{Treatment SS} + \text{Error SS}
\]</span></p>
</section>
<section id="derivation" class="level3">
<h3 class="anchored" data-anchor-id="derivation">Derivation</h3>
<ol type="1">
<li><strong>Total Sum of Squares (SS<span class="math inline">\(_\text{Total}\)</span>):</strong></li>
</ol>
<p><span class="math display">\[
SS_\text{Total} = \sum_{h=1}^b \sum_{i=1}^t (Y_{hi} - \bar{Y})^2
\]</span></p>
<p>Where <span class="math inline">\(\bar{Y}\)</span> is the grand mean.</p>
<ol type="1">
<li><strong>Block Sum of Squares (SS<span class="math inline">\(_\text{Block}\)</span>):</strong></li>
</ol>
<p><span class="math display">\[
SS_\text{Block} = t \sum_{h=1}^b (\bar{Y}_h - \bar{Y})^2
\]</span></p>
<p>Where <span class="math inline">\(\bar{Y}_h\)</span> is the mean of block <span class="math inline">\(h\)</span>.</p>
<ol type="1">
<li><strong>Treatment Sum of Squares (SS<span class="math inline">\(_\text{Treatment}\)</span>):</strong></li>
</ol>
<p><span class="math display">\[
SS_\text{Treatment} = b \sum_{i=1}^t (\bar{Y}_i - \bar{Y})^2
\]</span></p>
<p>Where <span class="math inline">\(\bar{Y}_i\)</span> is the mean of treatment <span class="math inline">\(i\)</span>.</p>
<ol type="1">
<li><strong>Error Sum of Squares (SS<span class="math inline">\(_\text{Error}\)</span>):</strong></li>
</ol>
<p><span class="math display">\[
SS_\text{Error} = \sum_{h=1}^b \sum_{i=1}^t (Y_{hi} - \bar{Y}_h - \bar{Y}_i + \bar{Y})^2
\]</span></p>
<p>Represents variability not explained by blocks or treatments.</p>
<p><strong>Conclusion:</strong> The variance decomposition allows for the assessment of how much variability in the response is attributable to blocks, treatments, and random error.</p>
</section>
</section>
<section id="effects-of-ignoring-block-treatment-interaction" class="level2">
<h2 class="anchored" data-anchor-id="effects-of-ignoring-block-treatment-interaction">Effects of Ignoring Block-Treatment Interaction</h2>
<p>In the RCBD model, it is assumed that there is no interaction between blocks and treatments. Ignoring a significant block-treatment interaction can lead to biased estimates of treatment effects.</p>
<section id="mathematical-illustration" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-illustration">Mathematical Illustration</h3>
<p>Suppose the true model includes an interaction term:</p>
<p><span class="math display">\[
Y_{hi} = \mu + \theta_h + \tau_i + (\theta \tau)^*_{hi} + \epsilon^*_{hi}
\]</span></p>
<p>If the interaction term <span class="math inline">\((\theta \tau)_{hi}\)</span> is significant and is omitted from the model, the estimates of <span class="math inline">\(\tau_i\)</span> will be biased because the model incorrectly attributes part of the interaction effect to treatment effects.</p>
</section>
<section id="proof-outline" class="level3">
<h3 class="anchored" data-anchor-id="proof-outline">Proof Outline</h3>
<ol type="1">
<li><strong>Full Model:</strong> Includes interaction.</li>
<li><strong>Reduced Model:</strong> Omits interaction.</li>
<li><strong>Bias Derivation:</strong> Show that <span class="math inline">\(\hat{\tau}_i\)</span> in the reduced model includes components of the interaction effect.</li>
</ol>
<p><strong>Conclusion:</strong> It is crucial to test for block-treatment interactions. If significant, a more complex model that includes interaction terms should be employed.</p>
</section>
</section>
<section id="sample-size-calculations-for-rcbds" class="level2">
<h2 class="anchored" data-anchor-id="sample-size-calculations-for-rcbds">Sample Size Calculations for RCBDs</h2>
<p>Determining the appropriate sample size is essential for achieving sufficient power to detect treatment effects.</p>
<section id="formula" class="level3">
<h3 class="anchored" data-anchor-id="formula">Formula</h3>
<p><span class="math display">\[
n \geq \frac{2 v \sigma^2 \phi^2}{b \Delta^2}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(n\)</span>: Number of replicates per treatment.</li>
<li><span class="math inline">\(v\)</span>: Number of treatments.</li>
<li><span class="math inline">\(\sigma^2\)</span>: Estimated variance of the response.</li>
<li><span class="math inline">\(\phi\)</span>: Desired power (e.g., 0.80).</li>
<li><span class="math inline">\(b\)</span>: Number of blocks.</li>
<li><span class="math inline">\(\Delta\)</span>: Minimum detectable effect size.</li>
</ul>
</section>
<section id="derivation-1" class="level3">
<h3 class="anchored" data-anchor-id="derivation-1">Derivation</h3>
<ol type="1">
<li><p><strong>Power Analysis:</strong> Based on the desired power (<span class="math inline">\(\phi\)</span>) and significance level (<span class="math inline">\(\alpha\)</span>), determine the non-centrality parameter needed to detect effect size <span class="math inline">\(\Delta\)</span>.</p></li>
<li><p><strong>Rearrange for <span class="math inline">\(n\)</span>:</strong> Solving the power equation for <span class="math inline">\(n\)</span> yields the sample size formula.</p></li>
</ol>
<p><strong>Example Calculation:</strong> Suppose you have 4 treatments (<span class="math inline">\(v = 4\)</span>), 5 blocks (<span class="math inline">\(b = 5\)</span>), an estimated variance (<span class="math inline">\(\sigma^2 = 20\)</span>), desire a power of 0.80 (<span class="math inline">\(\phi = 0.84\)</span>), and aim to detect a minimum effect size of 5 units (<span class="math inline">\(\Delta = 5\)</span>).</p>
<p><span class="math display">\[
n \geq \frac{2 \times 4 \times 20 \times 0.84^2}{5 \times 5^2} = \frac{2 \times 4 \times 20 \times 0.7056}{125} \approx \frac{113.792}{125} \approx 0.91
\]</span></p>
<p>Since <span class="math inline">\(n\)</span> must be an integer, at least 1 replicate per treatment is needed. However, practical considerations often necessitate larger sample sizes.</p>
</section>
</section>
</section>
<section id="exercises" class="level1">
<h1>Exercises</h1>
<section id="medium-difficulty" class="level2">
<h2 class="anchored" data-anchor-id="medium-difficulty">Medium Difficulty</h2>
<ol type="1">
<li><strong>Two-Way ANCOVA with Interaction:</strong>
<ul>
<li><strong>Dataset:</strong> Simulate a dataset with three treatments and one covariate.</li>
<li><strong>Tasks:</strong>
<ul>
<li>Generate data for treatments A, B, C with a covariate X.</li>
<li>Fit an ANCOVA model adjusting for X.</li>
<li>Test the significance of treatment effects and the covariate.</li>
<li>Generate diagnostic plots and interpret them.</li>
</ul></li>
</ul></li>
</ol>
<p><strong>R Code Example:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define factors and covariate</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>Treatment <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>), <span class="at">each =</span> <span class="dv">30</span>))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">90</span>, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate responses with treatment effects and covariate effect</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">+</span> <span class="fu">ifelse</span>(Treatment <span class="sc">==</span> <span class="st">"A"</span>, <span class="dv">0</span>, <span class="fu">ifelse</span>(Treatment <span class="sc">==</span> <span class="st">"B"</span>, <span class="dv">2</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.5</span> <span class="sc">*</span> (X <span class="sc">-</span> <span class="fu">mean</span>(X)) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">90</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>data_sim <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Treatment, X, Y)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit ANCOVA model</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>model_sim <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> Treatment <span class="sc">+</span> X, <span class="at">data =</span> data_sim)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_sim)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostic plots</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_sim)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated marginal means</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>emm_sim <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(model_sim, <span class="sc">~</span>Treatment)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>pairwise_sim <span class="ot">&lt;-</span> <span class="fu">contrast</span>(emm_sim, <span class="at">method =</span> <span class="st">"pairwise"</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pairwise_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Questions:</strong></p>
<ul>
<li>What are the main effects of Treatment and the covariate X?</li>
<li>Are there significant differences between treatments after adjusting for X?</li>
<li>Do the diagnostic plots suggest any assumption violations?</li>
</ul>
<ol start="2" type="1">
<li><p><strong>Balloon Data Analysis:</strong></p>
<ul>
<li><strong>Scenario:</strong> Reanalyze the balloon data, testing for equality of slopes.</li>
<li><strong>Tasks:</strong>
<ul>
<li>Fit an ANCOVA model.</li>
<li>Test the homogeneity of regression slopes.</li>
<li>Interpret the adjusted treatment means.</li>
</ul></li>
</ul></li>
</ol>
<p><strong>R Code Example:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and prepare data</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>balloon.data <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"data/dean2017/balloon.txt"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>balloon.data <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>balloon.data <span class="ot">&lt;-</span> <span class="fu">within</span>(balloon.data, {</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> Order <span class="sc">-</span> <span class="fu">mean</span>(Order)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    fColor <span class="ot">&lt;-</span> <span class="fu">factor</span>(Color)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit ANCOVA model</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(Time <span class="sc">~</span> fColor <span class="sc">+</span> x, <span class="at">data =</span> balloon.data)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Test homogeneity of slopes</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>model_interaction <span class="ot">&lt;-</span> <span class="fu">lm</span>(Time <span class="sc">~</span> fColor <span class="sc">*</span> x, <span class="at">data =</span> balloon.data)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model, model_interaction)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated marginal means</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>emm_balloon <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(model, <span class="sc">~</span>fColor)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>pairwise_balloon <span class="ot">&lt;-</span> <span class="fu">contrast</span>(emm_balloon, <span class="at">method =</span> <span class="st">"pairwise"</span>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pairwise_balloon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Questions:</strong></p>
<ul>
<li>Does the interaction term indicate equality of slopes across treatments?</li>
<li>How do the adjusted means compare across balloon colors?</li>
<li>What conclusions can be drawn about the effect of balloon color on inflation time after adjusting for run order?</li>
</ul>
</section>
<section id="challenging-problems" class="level2">
<h2 class="anchored" data-anchor-id="challenging-problems">Challenging Problems</h2>
<ol type="1">
<li><strong>Unbalanced Two-Factor ANCOVA Analysis:</strong>
<ul>
<li><strong>Dataset:</strong> Utilize a dataset with unequal numbers of replicates across treatment combinations.</li>
<li><strong>Tasks:</strong>
<ul>
<li>Simulate an unbalanced dataset with two factors and one covariate.</li>
<li>Fit an ANCOVA model using both Type II and Type III sums of squares.</li>
<li>Compare the results and discuss how imbalance affects the interpretation of main and interaction effects.</li>
</ul></li>
</ul></li>
</ol>
<p><strong>R Code Example:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate unbalanced data</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>FactorA <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A1"</span>, <span class="st">"A2"</span>, <span class="st">"A3"</span>), <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">5</span>)))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>FactorB <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"B1"</span>, <span class="st">"B2"</span>), <span class="at">each =</span> <span class="dv">7</span>, <span class="at">times =</span> <span class="dv">2</span>))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">15</span>, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate responses with treatment and covariate effects</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">+</span> <span class="fu">ifelse</span>(FactorA <span class="sc">==</span> <span class="st">"A1"</span>, <span class="dv">0</span>, <span class="fu">ifelse</span>(FactorA <span class="sc">==</span> <span class="st">"A2"</span>, <span class="dv">2</span>, <span class="dv">4</span>)) <span class="sc">+</span> <span class="fu">ifelse</span>(FactorB <span class="sc">==</span> <span class="st">"B1"</span>, <span class="dv">0</span>, <span class="dv">3</span>) <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> (X <span class="sc">-</span> <span class="fu">mean</span>(X)) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">15</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>data_unbalanced <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(FactorA, FactorB, X, Y)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit ANCOVA model</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>fit_unbalanced <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> FactorA <span class="sc">*</span> FactorB <span class="sc">+</span> X, <span class="at">data =</span> data_unbalanced)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Type II Sum of Squares</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>typeII <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">Anova</span>(fit_unbalanced, <span class="at">type =</span> <span class="st">"II"</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(typeII)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Type III Sum of Squares</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>typeIII <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">Anova</span>(fit_unbalanced, <span class="at">type =</span> <span class="st">"III"</span>)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(typeIII)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="discussion-points" class="level2">
<h2 class="anchored" data-anchor-id="discussion-points">Discussion Points</h2>
<ul>
<li><strong>Type II vs.&nbsp;Type III SS:</strong>
<ul>
<li><strong>Type II:</strong> Tests main effects after accounting for other main effects but ignores interactions.</li>
<li><strong>Type III:</strong> Tests main effects after accounting for all other factors, including interactions.</li>
</ul></li>
<li><strong>Impact of Imbalance:</strong>
<ul>
<li>Imbalanced designs can lead to different interpretations under Type II and Type III SS.</li>
<li>Type I SS is not appropriate here as it is sequential and depends on the order of factors.</li>
</ul></li>
<li><strong>Significance of Effects:</strong>
<ul>
<li>Identify which factors and interactions are significant under each type.</li>
<li>Discuss how imbalance might inflate or deflate the significance levels of certain effects.</li>
</ul></li>
<li><strong>Implications for Experimental Conclusions:</strong>
<ul>
<li>Choosing the appropriate type of sums of squares is crucial for accurate inference.</li>
<li>Misinterpretation can lead to incorrect conclusions about factor effects and interactions.</li>
</ul></li>
</ul>
<ol start="2" type="1">
<li><strong>Three-Factor Interaction Interpretation:</strong>
<ul>
<li><strong>Dataset:</strong> Use a simulated dataset with three factors exhibiting a significant three-way interaction.</li>
<li><strong>Tasks:</strong>
<ul>
<li>Simulate data with three factors and one covariate.</li>
<li>Fit a three-way ANCOVA model.</li>
<li>Visualize the three-way interaction.</li>
<li>Use <code>emmeans</code> to estimate marginal means and perform pairwise comparisons.</li>
<li>Explain how the three-way interaction affects the interpretation of main and two-way interactions.</li>
</ul></li>
</ul></li>
</ol>
</section>
<section id="r-code-example" class="level2">
<h2 class="anchored" data-anchor-id="r-code-example">R Code Example</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">789</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate data</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>FactorA <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A1"</span>, <span class="st">"A2"</span>, <span class="st">"A3"</span>), <span class="at">each =</span> <span class="dv">24</span>))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>FactorB <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"B1"</span>, <span class="st">"B2"</span>), <span class="at">each =</span> <span class="dv">12</span>, <span class="at">times =</span> <span class="dv">3</span>))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>FactorC <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>, <span class="st">"C3"</span>), <span class="at">times =</span> <span class="dv">8</span>))</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">72</span>, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate responses with three-way interaction</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">+</span> <span class="fu">ifelse</span>(FactorA <span class="sc">==</span> <span class="st">"A1"</span>, <span class="dv">0</span>, <span class="fu">ifelse</span>(FactorA <span class="sc">==</span> <span class="st">"A2"</span>, <span class="dv">2</span>, <span class="dv">4</span>)) <span class="sc">+</span> <span class="fu">ifelse</span>(FactorB <span class="sc">==</span> <span class="st">"B1"</span>, <span class="dv">0</span>, <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">ifelse</span>(FactorC <span class="sc">==</span> <span class="st">"C1"</span>, <span class="dv">0</span>, <span class="fu">ifelse</span>(FactorC <span class="sc">==</span> <span class="st">"C2"</span>, <span class="fl">1.5</span>, <span class="dv">3</span>)) <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> (X <span class="sc">-</span> <span class="fu">mean</span>(X)) <span class="sc">+</span> <span class="fu">ifelse</span>(FactorA <span class="sc">==</span> <span class="st">"A1"</span> <span class="sc">&amp;</span> FactorB <span class="sc">==</span> <span class="st">"B1"</span>, <span class="dv">0</span>, <span class="fu">ifelse</span>(FactorA <span class="sc">==</span> <span class="st">"A2"</span> <span class="sc">&amp;</span> FactorB <span class="sc">==</span> <span class="st">"B2"</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">72</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>data_three <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(FactorA, FactorB, FactorC, X, Y)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit three-way ANCOVA model</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>fit_three <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> FactorA <span class="sc">*</span> FactorB <span class="sc">*</span> FactorC <span class="sc">+</span> X, <span class="at">data =</span> data_three)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_three)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot three-way interaction</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_three, <span class="fu">aes</span>(<span class="at">x =</span> FactorA, <span class="at">y =</span> Y, <span class="at">color =</span> FactorB, <span class="at">group =</span> FactorB)) <span class="sc">+</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>FactorC) <span class="sc">+</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Three-Way Interaction Plot"</span>, <span class="at">x =</span> <span class="st">"Factor A"</span>, <span class="at">y =</span> <span class="st">"Response"</span>) <span class="sc">+</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated marginal means</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>emm_three <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fit_three, <span class="sc">~</span> FactorA <span class="sc">*</span> FactorB <span class="sc">*</span> FactorC)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>contrast_results <span class="ot">&lt;-</span> <span class="fu">contrast</span>(emm_three, <span class="at">method =</span> <span class="st">"pairwise"</span>, <span class="at">adjust =</span> <span class="st">"none"</span>)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(contrast_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="interpretation" class="level2">
<h2 class="anchored" data-anchor-id="interpretation">Interpretation</h2>
<ul>
<li><p><strong>Three-Way Interaction:</strong> The interaction plot shows how the interaction between Factor A and Factor B varies across levels of Factor C. Non-parallel lines across different facets (Factor C levels) indicate a significant three-way interaction.</p></li>
<li><p><strong>Impact on Main and Two-Way Interactions:</strong> Significant higher-order interactions imply that main effects and two-way interactions cannot be interpreted in isolation. The effect of one factor depends on the combination of other factors.</p></li>
<li><p><strong>Practical Implications:</strong> Understanding three-way interactions allows for more nuanced insights into how multiple factors jointly influence the response variable, leading to better-informed decisions and strategies.</p></li>
</ul>
<p><strong>Reference:</strong> Dean, Voss &amp; Draguljić (2017) elaborate on interpreting higher-order interactions in <em>Design and Analysis of Experiments</em>.</p>
<ol start="3" type="1">
<li><strong>Mathematical Proof of Interaction Contrasts:</strong>
<ul>
<li><strong>Task:</strong> Derive formulas for interaction contrasts in a three-factor design and prove that they measure deviations from additivity.</li>
<li><strong>Requirements:</strong>
<ul>
<li>Show how to construct interaction contrasts.</li>
<li>Prove that if all interaction contrasts are zero, the model is additive.</li>
</ul></li>
</ul></li>
</ol>
<p><strong>Hints:</strong></p>
<ul>
<li>Utilize the definitions of main effects and interaction terms.</li>
<li>Employ properties of linear algebra to demonstrate the relationship between interaction contrasts and additivity.</li>
<li>Reference Dean et al.&nbsp;(2017) and Christensen (2018) for theoretical foundations.</li>
</ul>
</section>
<section id="proof-outline-1" class="level2">
<h2 class="anchored" data-anchor-id="proof-outline-1">Proof Outline</h2>
<ol type="1">
<li><strong>Define the Three-Factor Model:</strong></li>
</ol>
<p><span class="math display">\[
Y_{ijk} = \mu + \alpha_i + \beta_j + \gamma_k + (\alpha\beta)^*_{ij} + (\alpha\gamma)^*_{ik} + (\beta\gamma)^*_{jk} + (\alpha\beta\gamma)^*_{ijk} + \epsilon_{ijk}
\]</span></p>
<p>where <span class="math inline">\(\sum \alpha_i = \sum \beta_j = \sum \gamma_k = 0\)</span>.</p>
<ol type="1">
<li><strong>Construct Interaction Contrasts:</strong></li>
</ol>
<ul>
<li><strong>Two-Way Interactions:</strong>
<ul>
<li><span class="math inline">\((\alpha\beta)^*_{ij}\)</span> measures the interaction between Factors A and B.</li>
<li>Similarly for <span class="math inline">\((\alpha\gamma)^*_{ik}\)</span> and <span class="math inline">\((\beta\gamma)^*_{jk}\)</span>.</li>
</ul></li>
<li><strong>Three-Way Interaction:</strong>
<ul>
<li><span class="math inline">\((\alpha\beta\gamma)_{ijk}\)</span> measures the deviation from additivity among all three factors.</li>
</ul></li>
</ul>
<ol start="2" type="1">
<li><strong>Proof of Additivity:</strong>
<ul>
<li><strong>Additive Model:</strong> If all interaction terms are zero (<span class="math inline">\((\alpha\beta)^*_{ij} = (\alpha\gamma)^*_{ik} = (\beta\gamma)^*{jk} = (\alpha\beta\gamma)^*_{ijk} = 0\)</span>), the model simplifies to:</li>
</ul></li>
</ol>
<p><span class="math display">\[
Y_{ijk} = \mu + \alpha_i + \beta_j + \gamma_k + \epsilon_{ijk}
\]</span></p>
<p>indicating that the response is purely additive with respect to the main effects.</p>
<ul>
<li><strong>Zero Interaction Contrasts:</strong><br>
If all interaction contrasts are zero, the model exhibits additivity. Thus, interaction contrasts quantify how much the actual model deviates from an additive one.</li>
</ul>
<ol type="1">
<li><strong>Conclusion:</strong></li>
</ol>
<p>Interaction contrasts provide a mathematical measure of the presence and magnitude of interactions. Non-zero contrasts indicate that the combined effect of factors is not merely the sum of their individual effects, highlighting the importance of considering interactions in experimental analysis.</p>
<p><strong>Reference:</strong> Dean, Voss &amp; Draguljić (2017) offer detailed mathematical treatments of interaction contrasts in <em>Design and Analysis of Experiments</em>.</p>
</section>
</section>
<section id="appendix-advanced-mathematical-derivations-1" class="level1">
<h1>Appendix: Advanced Mathematical Derivations</h1>
<section id="proof-of-rcbd-model-assumptions-1" class="level2">
<h2 class="anchored" data-anchor-id="proof-of-rcbd-model-assumptions-1">Proof of RCBD Model Assumptions</h2>
<section id="variance-decomposition-3" class="level3">
<h3 class="anchored" data-anchor-id="variance-decomposition-3">1. Variance Decomposition</h3>
<p>The RCBD model is expressed as:</p>
<p><span class="math display">\[
Y_{hi} = \mu + \theta_h + \tau_i + \epsilon_{hi}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(Y_{hi}\)</span>: Response for treatment <span class="math inline">\(i\)</span> in block <span class="math inline">\(h\)</span>.</li>
<li><span class="math inline">\(\mu\)</span>: Overall mean.</li>
<li><span class="math inline">\(\theta_h\)</span>: Effect of block <span class="math inline">\(h\)</span>.</li>
<li><span class="math inline">\(\tau_i\)</span>: Effect of treatment <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(\epsilon_{hi} \sim N(0, \sigma^2)\)</span>: Error term.</li>
</ul>
<p><strong>Assumptions:</strong> 1. <strong>Normality:</strong> <span class="math inline">\(\epsilon_{hi}\)</span> are normally distributed. 2. <strong>Independence:</strong> Observations are independent. 3. <strong>Homoscedasticity:</strong> <span class="math inline">\(\sigma^2\)</span> is constant across all treatments and blocks. 4. <strong>No Interaction:</strong> Effects of blocks and treatments are additive.</p>
<p><strong>Variance Decomposition:</strong></p>
<p><span class="math display">\[
\text{Total SS} = \text{Block SS} + \text{Treatment SS} + \text{Error SS}
\]</span></p>
<p><strong>Derivation:</strong> 1. <strong>Total Sum of Squares (SS<span class="math inline">\(_\text{Total}\)</span>):</strong></p>
<p><span class="math display">\[
SS_\text{Total} = \sum_{h=1}^b \sum_{i=1}^t (Y_{hi} - \bar{Y})^2
\]</span></p>
<p>Where <span class="math inline">\(\bar{Y}\)</span> is the grand mean.</p>
<ol type="1">
<li><strong>Block Sum of Squares (SS<span class="math inline">\(_\text{Block}\)</span>):</strong></li>
</ol>
<p><span class="math display">\[
SS_\text{Block} = t \sum_{h=1}^b (\bar{Y}_h - \bar{Y})^2
\]</span></p>
<p>Where <span class="math inline">\(\bar{Y}_h\)</span> is the mean of block <span class="math inline">\(h\)</span>.</p>
<ol type="1">
<li><strong>Treatment Sum of Squares (SS<span class="math inline">\(_\text{Treatment}\)</span>):</strong></li>
</ol>
<p><span class="math display">\[
SS_\text{Treatment} = b \sum_{i=1}^t (\bar{Y}_i - \bar{Y})^2
\]</span></p>
<p>Where <span class="math inline">\(\bar{Y}_i\)</span> is the mean of treatment <span class="math inline">\(i\)</span>.</p>
<ol type="1">
<li><strong>Error Sum of Squares (SS<span class="math inline">\(_\text{Error}\)</span>):</strong></li>
</ol>
<p><span class="math display">\[
SS_\text{Error} = \sum_{h=1}^b \sum_{i=1}^t (Y_{hi} - \bar{Y}_h - \bar{Y}_i + \bar{Y})^2
\]</span></p>
<p>Represents variability not explained by blocks or treatments.</p>
<p><strong>Conclusion:</strong> The variance decomposition allows for the assessment of how much variability in the response is attributable to blocks, treatments, and random error.</p>
<p><strong>Reference:</strong> Montgomery (2019) provides a detailed derivation of ANOVA components in <em>Design and Analysis of Experiments</em>.</p>
</section>
<section id="effects-of-ignoring-block-treatment-interaction-1" class="level3">
<h3 class="anchored" data-anchor-id="effects-of-ignoring-block-treatment-interaction-1">2. Effects of Ignoring Block-Treatment Interaction</h3>
<p>In the RCBD model, it is assumed that there is no interaction between blocks and treatments. Ignoring a significant block-treatment interaction can lead to biased estimates of treatment effects.</p>
<p><strong>Mathematical Illustration:</strong></p>
<p>Suppose the true model includes an interaction term:</p>
<p><span class="math display">\[
Y_{hi} = \mu + \theta_h + \tau_i + (\theta \tau)^*_{hi} + \epsilon^*_{hi}
\]</span></p>
<p>If the interaction term <span class="math inline">\((\theta \tau)_{hi}\)</span> is significant and is omitted from the model, the estimates of <span class="math inline">\(\tau_i\)</span> will be biased because the model incorrectly attributes part of the interaction effect to treatment effects.</p>
<p><strong>Proof Outline:</strong> 1. <strong>Full Model:</strong> Includes interaction. 2. <strong>Reduced Model:</strong> Omits interaction. 3. <strong>Bias Derivation:</strong> Show that <span class="math inline">\(\hat{\tau}_i\)</span> in the reduced model includes components of the interaction effect.</p>
<p><strong>Conclusion:</strong> It is crucial to test for block-treatment interactions. If significant, a more complex model that includes interaction terms should be employed.</p>
<p><strong>Reference:</strong> Kempthorne (1977) discusses the implications of model misspecification in <em>Design and Analysis of Experiments</em>.</p>
</section>
</section>
<section id="sample-size-calculations-for-rcbds-1" class="level2">
<h2 class="anchored" data-anchor-id="sample-size-calculations-for-rcbds-1">Sample Size Calculations for RCBDs</h2>
<p>Determining the appropriate sample size is essential for ensuring adequate power to detect treatment effects.</p>
<section id="formula-1" class="level3">
<h3 class="anchored" data-anchor-id="formula-1">Formula</h3>
<p><span class="math display">\[
n \geq \frac{2 v \sigma^2 \phi^2}{b \Delta^2}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(n\)</span>: Number of replicates per treatment.</li>
<li><span class="math inline">\(v\)</span>: Number of treatments.</li>
<li><span class="math inline">\(\sigma^2\)</span>: Variance estimate.</li>
<li><span class="math inline">\(\phi\)</span>: Desired power (e.g., 0.80).</li>
<li><span class="math inline">\(b\)</span>: Number of blocks.</li>
<li><span class="math inline">\(\Delta\)</span>: Minimum detectable effect size.</li>
</ul>
</section>
<section id="derivation-2" class="level3">
<h3 class="anchored" data-anchor-id="derivation-2">Derivation</h3>
<ol type="1">
<li><p><strong>Power Analysis:</strong> Based on the desired power (<span class="math inline">\(\phi\)</span>) and significance level (<span class="math inline">\(\alpha\)</span>), determine the non-centrality parameter needed to detect effect size <span class="math inline">\(\Delta\)</span>.</p></li>
<li><p><strong>Rearrange for <span class="math inline">\(n\)</span>:</strong> Solving the power equation for <span class="math inline">\(n\)</span> yields the sample size formula.</p></li>
</ol>
<p><strong>Example Calculation:</strong></p>
<p>Suppose you have 4 treatments (<span class="math inline">\(v = 4\)</span>), 5 blocks (<span class="math inline">\(b = 5\)</span>), an estimated variance (<span class="math inline">\(\sigma^2 = 20\)</span>), desire a power of 0.80 (<span class="math inline">\(\phi = 0.84\)</span>), and aim to detect a minimum effect size of 5 units (<span class="math inline">\(\Delta = 5\)</span>).</p>
<p><span class="math display">\[
n \geq \frac{2 \times 4 \times 20 \times 0.84^2}{5 \times 5^2} = \frac{2 \times 4 \times 20 \times 0.7056}{125} \approx \frac{113.792}{125} \approx 0.91
\]</span></p>
<p>Since <span class="math inline">\(n\)</span> must be an integer, at least 1 replicate per treatment is needed. However, practical considerations often necessitate larger sample sizes.</p>
<p><strong>Reference:</strong> Montgomery (2019) elaborates on sample size determination in <em>Design and Analysis of Experiments</em>.</p>
</section>
</section>
<section id="handling-block-treatment-interactions-1" class="level2">
<h2 class="anchored" data-anchor-id="handling-block-treatment-interactions-1">Handling Block-Treatment Interactions</h2>
<p>In scenarios where interaction effects between blocks and treatments are suspected, it is essential to include them in the model to avoid biased estimates and incorrect inferences.</p>
<section id="model-with-interaction-1" class="level3">
<h3 class="anchored" data-anchor-id="model-with-interaction-1">Model with Interaction</h3>
<p><span class="math display">\[
Y_{hi} = \mu + \theta_h + \tau_i + (\theta \tau)^*_{hi} + \epsilon^*_{hi}
\]</span></p>
<p><strong>Implications:</strong></p>
<ul>
<li><strong>Significant Interaction:</strong> Suggests that the effect of treatments varies across blocks. Separate treatment effect analyses within each block may be necessary.</li>
<li><strong>Non-Significant Interaction:</strong> Supports the additive model, validating the use of standard RCBD analysis.</li>
</ul>
<p><strong>Reference:</strong> Kempthorne (1977) elaborates on the importance of accounting for interactions in <em>Design and Analysis of Experiments</em>.</p>
</section>
</section>
<section id="sample-size-calculation-example-in-r" class="level2">
<h2 class="anchored" data-anchor-id="sample-size-calculation-example-in-r">Sample Size Calculation Example in R</h2>
<p>To determine the necessary number of replicates per treatment in an RCBD, you can use R for power and sample size calculations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="co"># Number of treatments</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="co"># Number of blocks</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="ot">&lt;-</span> <span class="dv">20</span> <span class="co"># Variance estimate</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fl">0.84</span> <span class="co"># Desired power (approx 0.80)</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>Delta <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="co"># Minimum detectable effect size</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate sample size</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ceiling</span>((<span class="dv">2</span> <span class="sc">*</span> v <span class="sc">*</span> sigma2 <span class="sc">*</span> phi<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (b <span class="sc">*</span> Delta<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation:</strong> The <code>ceiling</code> function ensures that the sample size is rounded up to the next integer, ensuring adequate power.</p>
</section>
</section>
<section id="exercises-1" class="level1">
<h1>Exercises</h1>
<section id="medium-difficulty-1" class="level2">
<h2 class="anchored" data-anchor-id="medium-difficulty-1">Medium Difficulty</h2>
<ol type="1">
<li><strong>Two-Way ANCOVA with Interaction:</strong>
<ul>
<li><strong>Dataset:</strong> Simulate a dataset with three treatments and one covariate.</li>
<li><strong>Tasks:</strong>
<ul>
<li>Generate data for treatments A, B, C with a covariate X.</li>
<li>Fit an ANCOVA model adjusting for X.</li>
<li>Test the significance of treatment effects and the covariate.</li>
<li>Generate diagnostic plots and interpret them.</li>
</ul></li>
</ul></li>
</ol>
<p><strong>R Code Example:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define factors and covariate</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>Treatment <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>), <span class="at">each=</span><span class="dv">30</span>))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">90</span>, <span class="at">mean=</span><span class="dv">50</span>,   <span class="at">sd=</span><span class="dv">10</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate responses with treatment effects and covariate effect</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Treatment <span class="sc">==</span> <span class="st">"A"</span>, <span class="dv">0</span>, <span class="fu">ifelse</span>(Treatment <span class="sc">==</span> <span class="st">"B"</span>, <span class="dv">2</span>, <span class="dv">4</span>) <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> (X <span class="sc">-</span> <span class="fu">mean</span>(X)) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">90</span>, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="dv">3</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>data_sim <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Treatment, X, Y)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit ANCOVA model</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>model_sim <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> Treatment <span class="sc">+</span> X, <span class="at">data =</span> data_sim)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_sim)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostic plots</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_sim)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated marginal means</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>emm_sim <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(model_sim <span class="sc">~</span> Treatment)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>pairwise_sim <span class="ot">&lt;-</span> <span class="fu">contrast</span>(emm_sim, <span class="at">method =</span> <span class="st">"pairwise"</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pairwise_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Questions:</strong> - What are the main effects of Treatment and the covariate X? - Are there significant differences between treatments after adjusting for X? - Do the diagnostic plots suggest any assumption violations?</p>
<ol start="2" type="1">
<li><strong>Balloon Data Analysis:</strong>
<ul>
<li><strong>Scenario:</strong> Reanalyze the balloon data, testing for equality of slopes.</li>
<li><strong>Tasks:</strong>
<ul>
<li>Fit an ANCOVA model.</li>
<li>Test the homogeneity of regression slopes.</li>
<li>Interpret the adjusted treatment means.</li>
</ul></li>
</ul></li>
</ol>
<section id="r-code-example-1" class="level3">
<h3 class="anchored" data-anchor-id="r-code-example-1">R Code Example</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and prepare data</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>balloon.data <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"data/balloon.txt"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>balloon.data <span class="ot">&lt;-</span> <span class="fu">within</span>(balloon.data</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>, x <span class="ot">&lt;-</span> Order <span class="sc">-</span> <span class="fu">mean</span>(Order)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>fColor <span class="ot">&lt;-</span> <span class="fu">factor</span>(Color)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="er">}</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit ANCOVA model</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(Time <span class="sc">~</span> fColor <span class="sc">+</span> x, <span class="at">data =</span> balloon.data)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Test homogeneity of slopes</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>model_interaction <span class="ot">&lt;-</span> <span class="fu">lm</span>(Time <span class="sc">~</span> fColor <span class="sc">*</span> x, <span class="at">data =</span> balloon.data)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model, model_interaction)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated marginal means</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>emm_balloon <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(model <span class="sc">~</span> fColor)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>pairwise_balloon <span class="ot">&lt;-</span> <span class="fu">contrast</span>(emm_balloon, <span class="at">method =</span> <span class="st">"pairwise"</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pairwise_balloon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Questions:</strong></p>
<ul>
<li>Does the interaction term indicate equality of slopes across treatments?</li>
<li>How do the adjusted means compare across balloon colors?</li>
<li>What conclusions can be drawn about the effect of balloon color on inflation time after adjusting for run order?</li>
</ul>
</section>
</section>
<section id="challenging-problems-1" class="level2">
<h2 class="anchored" data-anchor-id="challenging-problems-1">Challenging Problems</h2>
<ol type="1">
<li><strong>Unbalanced Two-Factor ANCOVA Analysis:</strong>
<ul>
<li><strong>Dataset:</strong> Utilize a dataset with unequal numbers of replicates across treatment combinations.</li>
<li><strong>Tasks:</strong>
<ul>
<li>Simulate an unbalanced dataset with two factors and one covariate.</li>
<li>Fit an ANCOVA model using both Type II and Type III sums of squares.</li>
<li>Compare the results and discuss how imbalance affects the interpretation of main and interaction effects.</li>
</ul></li>
</ul></li>
</ol>
<section id="r-code-example-2" class="level3">
<h3 class="anchored" data-anchor-id="r-code-example-2">R Code Example</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate unbalanced data</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>FactorA <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A1"</span>, <span class="st">"A2"</span>, <span class="st">"A3"</span>), <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">5</span>)))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>FactorB <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"B1"</span>, <span class="st">"B2"</span>), <span class="at">each =</span> <span class="dv">7</span>, <span class="at">times =</span> <span class="dv">2</span>))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">15</span>, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate responses with treatment and covariate effects</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">+</span> <span class="fu">ifelse</span>(FactorA <span class="sc">==</span> <span class="st">"A1"</span>, <span class="dv">0</span>, <span class="fu">ifelse</span>(FactorA <span class="sc">==</span> <span class="st">"A2"</span>, <span class="dv">2</span>, <span class="dv">4</span>)) <span class="sc">+</span> <span class="fu">ifelse</span>(FactorB <span class="sc">==</span> <span class="st">"B1"</span>, <span class="dv">0</span>, <span class="dv">3</span>) <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> (X <span class="sc">-</span> <span class="fu">mean</span>(X)) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">15</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>data_unbalanced <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(FactorA, FactorB, X, Y)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit ANCOVA model</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>fit_unbalanced <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> FactorA <span class="sc">*</span> FactorB <span class="sc">+</span> X, <span class="at">data =</span> data_unbalanced)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Type II Sum of Squares</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>typeII <span class="ot">&lt;-</span> <span class="fu">Anova</span>(fit_unbalanced, <span class="at">type =</span> <span class="st">"II"</span>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(typeII)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Type III Sum of Squares</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>typeIII <span class="ot">&lt;-</span> <span class="fu">Anova</span>(fit_unbalanced, <span class="at">type =</span> <span class="st">"III"</span>)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(typeIII)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="discussion-points-1" class="level2">
<h2 class="anchored" data-anchor-id="discussion-points-1">Discussion Points:</h2>
<ul>
<li><strong>Type II vs.&nbsp;Type III SS:</strong>
<ul>
<li><strong>Type II:</strong> Tests main effects after accounting for other main effects but ignores interactions.</li>
<li><strong>Type III:</strong> Tests main effects after accounting for all other factors, including interactions.</li>
</ul></li>
<li><strong>Impact of Imbalance:</strong>
<ul>
<li>Imbalanced designs can lead to different interpretations under Type II and Type III SS.</li>
<li>Type I SS is not appropriate here as it is sequential and depends on the order of factors.</li>
</ul></li>
<li><strong>Significance of Effects:</strong>
<ul>
<li>Identify which factors and interactions are significant under each type.</li>
<li>Discuss how imbalance might inflate or deflate the significance levels of certain effects.</li>
</ul></li>
<li><strong>Implications for Experimental Conclusions:</strong>
<ul>
<li>Choosing the appropriate type of sums of squares is crucial for accurate inference.</li>
<li>Misinterpretation can lead to incorrect conclusions about factor effects and interactions.</li>
</ul></li>
</ul>
<p><strong>Reference:</strong> Christensen (2018) provides guidance on handling unbalanced designs and selecting appropriate sums of squares types in <em>Analysis of Variance, Design, and Regression</em>.</p>
<ol start="2" type="1">
<li><strong>Three-Factor Interaction Interpretation:</strong>
<ul>
<li><strong>Dataset:</strong> Use a simulated dataset with three factors exhibiting a significant three-way interaction.</li>
<li><strong>Tasks:</strong>
<ul>
<li>Simulate data with three factors and one covariate.</li>
<li>Fit a three-way ANCOVA model.</li>
<li>Visualize the three-way interaction.</li>
<li>Use <code>emmeans</code> to estimate marginal means and perform pairwise comparisons.</li>
<li>Explain how the three-way interaction affects the interpretation of main and two-way interactions.</li>
</ul></li>
</ul></li>
</ol>
<section id="r-code-example-3" class="level3">
<h3 class="anchored" data-anchor-id="r-code-example-3">R Code Example:</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">789</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate data</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>FactorA <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A1"</span>, <span class="st">"A2"</span>, <span class="st">"A3"</span>), <span class="at">each =</span> <span class="dv">24</span>))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>FactorB <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"B1"</span>, <span class="st">"B2"</span>), <span class="at">each =</span> <span class="dv">12</span>, <span class="at">times =</span> <span class="dv">3</span>))</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>FactorC <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>, <span class="st">"C3"</span>), <span class="at">times =</span> <span class="dv">8</span>))</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">72</span>, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate responses with three-way interaction</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">+</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(FactorA <span class="sc">==</span> <span class="st">"A1"</span>, <span class="dv">0</span>, <span class="fu">ifelse</span>(FactorA <span class="sc">==</span> <span class="st">"A2"</span>, <span class="dv">2</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(FactorB <span class="sc">==</span> <span class="st">"B1"</span>, <span class="dv">0</span>, <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(FactorC <span class="sc">==</span> <span class="st">"C1"</span>, <span class="dv">0</span>, <span class="fu">ifelse</span>(FactorC <span class="sc">==</span> <span class="st">"C2"</span>, <span class="fl">1.5</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.5</span> <span class="sc">*</span> (X <span class="sc">-</span> <span class="fu">mean</span>(X)) <span class="sc">+</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(FactorA <span class="sc">==</span> <span class="st">"A1"</span> <span class="sc">&amp;</span> FactorB <span class="sc">==</span> <span class="st">"B1"</span>, <span class="dv">0</span>,</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(FactorA <span class="sc">==</span> <span class="st">"A2"</span> <span class="sc">&amp;</span> FactorB <span class="sc">==</span> <span class="st">"B2"</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnorm</span>(<span class="dv">72</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>data_three <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(FactorA, FactorB, FactorC, X, Y)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit three-way ANCOVA model</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>fit_three <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> FactorA <span class="sc">*</span> FactorB <span class="sc">*</span> FactorC <span class="sc">+</span> X, <span class="at">data =</span> data_three)</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_three)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot three-way interaction</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_three, <span class="fu">aes</span>(<span class="at">x =</span> FactorA, <span class="at">y =</span> Y, <span class="at">color =</span> FactorB, <span class="at">group =</span> FactorB)) <span class="sc">+</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>FactorC) <span class="sc">+</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Three-Way Interaction Plot"</span>, <span class="at">x =</span> <span class="st">"Factor A"</span>, <span class="at">y =</span> <span class="st">"Response"</span>) <span class="sc">+</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated marginal means</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>emm_three <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fit_three, <span class="sc">~</span> FactorA <span class="sc">*</span> FactorB <span class="sc">*</span> FactorC)</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>contrast_results <span class="ot">&lt;-</span> <span class="fu">contrast</span>(emm_three, <span class="at">method =</span> <span class="st">"pairwise"</span>, <span class="at">adjust =</span> <span class="st">"none"</span>)</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(contrast_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="interpretation-1" class="level2">
<h2 class="anchored" data-anchor-id="interpretation-1">Interpretation</h2>
<ul>
<li><p><strong>Three-Way Interaction:</strong> The interaction plot illustrates how the interaction between Factor A and Factor B varies across different levels of Factor C. Non-parallel lines across facets indicate a significant three-way interaction.</p></li>
<li><p><strong>Impact on Main and Two-Way Interactions:</strong> Significant higher-order interactions imply that main effects and two-way interactions cannot be interpreted in isolation. The effect of one factor depends on the combination of other factors.</p></li>
<li><p><strong>Practical Implications:</strong> Understanding three-way interactions allows for more nuanced insights into how multiple factors jointly influence the response variable, leading to better-informed decisions and strategies.</p></li>
</ul>
<p><strong>Reference:</strong> Dean, Voss &amp; Draguljić (2017) elaborate on interpreting higher-order interactions in <em>Design and Analysis of Experiments</em>.</p>
<ol start="3" type="1">
<li><strong>Mathematical Proof of Interaction Contrasts:</strong>
<ul>
<li><strong>Task:</strong> Derive formulas for interaction contrasts in a three-factor design and prove that they measure deviations from additivity.</li>
<li><strong>Requirements:</strong>
<ul>
<li>Show how to construct interaction contrasts.</li>
<li>Prove that if all interaction contrasts are zero, the model is additive.</li>
</ul></li>
</ul>
<strong>Hints:</strong>
<ul>
<li>Utilize the definitions of main effects and interaction terms.</li>
<li>Employ properties of linear algebra to demonstrate the relationship between interaction contrasts and additivity.</li>
<li>Reference Dean et al.&nbsp;(2017) and Christensen (2018) for theoretical foundations.</li>
</ul></li>
</ol>
</section>
<section id="proof-outline-2" class="level2">
<h2 class="anchored" data-anchor-id="proof-outline-2">Proof Outline:</h2>
<ol start="4" type="1">
<li><strong>Define the Three-Factor Model:</strong></li>
</ol>
<p><span class="math display">\[
Y_{ijk} = \mu + \alpha_i + \beta_j + \gamma_k + (\alpha\beta)^*_{ij} + (\alpha\gamma)^*{ik} + (\beta\gamma)^*_{jk} + (\alpha\beta\gamma)^*_{ijk} + \epsilon_{ijk}
\]</span></p>
<p>where <span class="math inline">\(\sum \alpha_i = \sum \beta_j = \sum \gamma_k = 0\)</span>.</p>
<ol type="1">
<li><strong>Construct Interaction Contrasts:</strong></li>
</ol>
<ul>
<li><strong>Two-Way Interactions:</strong></li>
<li><span class="math inline">\((\alpha\beta)_{ij}\)</span> measures the interaction between Factors A and B.</li>
<li>Similarly for <span class="math inline">\((\alpha\gamma)^*_{ik}\)</span> and <span class="math inline">\((\beta\gamma)^*_{jk}\)</span>.</li>
<li><strong>Three-Way Interaction:</strong></li>
<li><span class="math inline">\((\alpha\beta\gamma)_{ijk}\)</span> measures the deviation from additivity among all three factors.</li>
</ul>
<ol start="2" type="1">
<li><strong>Proof of Additivity:</strong></li>
</ol>
<ul>
<li><strong>Additive Model:</strong> If all interaction terms are zero (<span class="math inline">\((\alpha\beta)^*_{ij} = (\alpha\gamma)^*_{ik} = (\beta\gamma)^*_{jk} = (\alpha\beta\gamma)^*_{ijk} = 0\)</span>), the model simplifies to:</li>
</ul>
<p><span class="math display">\[
Y_{ijk} = \mu + \alpha_i + \beta_j + \gamma_k + \epsilon_{ijk}
\]</span></p>
<p>indicating that the response is purely additive with respect to the main effects.</p>
<ul>
<li><strong>Zero Interaction Contrasts:</strong><br>
If all interaction contrasts are zero, the model exhibits additivity. Thus, interaction contrasts quantify how much the actual model deviates from an additive one.</li>
</ul>
<ol type="1">
<li><strong>Conclusion:</strong></li>
</ol>
<p>Interaction contrasts provide a mathematical measure of the presence and magnitude of interactions. Non-zero contrasts indicate that the combined effect of factors is not merely the sum of their individual effects, highlighting the importance of considering interactions in experimental analysis.</p>
<p><strong>Reference:</strong> Dean, Voss &amp; Draguljić (2017) offer detailed mathematical treatments of interaction contrasts in <em>Design and Analysis of Experiments</em>.</p>
</section>
</section>
<section id="appendix-advanced-mathematical-derivations-2" class="level1">
<h1>Appendix: Advanced Mathematical Derivations</h1>
<section id="adjusted-treatment-means" class="level2">
<h2 class="anchored" data-anchor-id="adjusted-treatment-means">Adjusted Treatment Means</h2>
<p>The <strong>adjusted mean</strong> for treatment <span class="math inline">\(i\)</span> accounts for the influence of the covariate, providing a more accurate estimate of the treatment effect.</p>
<p><span class="math display">\[
\mu + \tau_i = \bar{Y}_i - \beta (\bar{X}_i - \bar{X})
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\mu\)</span>: Overall mean.</li>
<li><span class="math inline">\(\tau_i\)</span>: Treatment effect for treatment <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(\bar{Y}_i\)</span>: Mean response for treatment <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(\beta\)</span>: Regression coefficient for the covariate.</li>
<li><span class="math inline">\(\bar{X}_i\)</span>: Mean covariate value for treatment <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(\bar{X}\)</span>: Overall mean of the covariate.</li>
</ul>
</section>
<section id="derivation-3" class="level2">
<h2 class="anchored" data-anchor-id="derivation-3">Derivation</h2>
<ol type="1">
<li><strong>Model Equation:</strong></li>
</ol>
<p><span class="math display">\[
Y_{ij} = \mu + \tau_i + \beta (X_{ij} - \bar{X}) + \epsilon_{ij}
\]</span></p>
<ol start="2" type="1">
<li><strong>Taking the Mean for Treatment <span class="math inline">\(i\)</span>:</strong></li>
</ol>
<p><span class="math display">\[
\bar{Y}_i = \mu + \tau_i + \beta (\bar{X}_i - \bar{X}) + \bar{\epsilon}_i
\]</span></p>
<p>Since <span class="math inline">\(\bar{\epsilon}_i = 0\)</span> (assuming errors have mean zero),</p>
<p><span class="math display">\[
\bar{Y}_i = \mu + \tau_i + \beta (\bar{X}_i - \bar{X})
\]</span></p>
<ol start="3" type="1">
<li><strong>Solving for Adjusted Mean:</strong></li>
</ol>
<p><span class="math display">\[
\mu + \tau_i = \bar{Y}_i - \beta (\bar{X}_i - \bar{X})
\]</span></p>
<p>This equation represents the adjusted treatment mean, accounting for differences in the covariate.</p>
<p><strong>Reference:</strong> Montgomery (2019) and Scheffé (1959) provide detailed derivations of adjusted means in ANCOVA.</p>
<section id="f-test-for-homogeneity-of-slopes" class="level3">
<h3 class="anchored" data-anchor-id="f-test-for-homogeneity-of-slopes">F-Test for Homogeneity of Slopes</h3>
<p>Testing the assumption of <strong>homogeneity of regression slopes</strong> ensures that the relationship between the covariate and the response is consistent across all treatment groups.</p>
</section>
<section id="model-comparison" class="level3">
<h3 class="anchored" data-anchor-id="model-comparison">Model Comparison</h3>
<ol type="1">
<li><strong>Model Without Interaction (Assuming Homogeneous Slopes):</strong> <span class="math display">\[
Y_{hi} = \mu + \theta_h + \tau_i + \beta X_{hi} + \epsilon_{hi}
\]</span></li>
</ol>
<p>Where <span class="math inline">\(\beta\)</span> is the common slope for all treatments.</p>
<ol start="2" type="1">
<li><strong>Model With Interaction (Allowing Slopes to Vary):</strong> <span class="math display">\[
Y_{hi} = \mu + \theta_h + \tau_i + \beta X_{hi} + (\theta \tau)^*_{hi} + \epsilon^*_{hi}
\]</span></li>
</ol>
<p>Where <span class="math inline">\((\theta \tau)_{hi}\)</span> allows the slope of the covariate to vary with treatments.</p>
</section>
<section id="hypothesis-testing" class="level3">
<h3 class="anchored" data-anchor-id="hypothesis-testing">Hypothesis Testing</h3>
<ul>
<li><strong>Null Hypothesis (<span class="math inline">\(H_0\)</span>):</strong> Homogeneity of slopes (<span class="math inline">\(\beta\)</span> is the same across treatments).</li>
<li><strong>Alternative Hypothesis (<span class="math inline">\(H_A\)</span>):</strong> Slopes vary across treatments (<span class="math inline">\(\beta_i \neq \beta_j\)</span> for some <span class="math inline">\(i, j\)</span>).</li>
</ul>
</section>
<section id="test-statistic" class="level3">
<h3 class="anchored" data-anchor-id="test-statistic">Test Statistic</h3>
<p><span class="math display">\[
F = \frac{\text{SSR}^*_{\text{Interaction}} / \text{DF}^*_{\text{Interaction}}}{\text{SSE} / \text{DF}_{\text{Error}}}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\text{SSR}_{\text{Interaction}}\)</span>: Sum of squares for the interaction term.</li>
<li><span class="math inline">\(\text{DF}_{\text{Interaction}}\)</span>: Degrees of freedom for the interaction.</li>
<li><span class="math inline">\(\text{SSE}\)</span>: Sum of squares for error.</li>
<li><span class="math inline">\(\text{DF}_{\text{Error}}\)</span>: Degrees of freedom for error.</li>
</ul>
<p><strong>Decision Rule:</strong> Reject <span class="math inline">\(H_0\)</span> if <span class="math inline">\(F\)</span> exceeds the critical value from the F-distribution with degrees of freedom <span class="math inline">\((\text{DF}*{\text{Interaction}}, \text{DF}*{\text{Error}})\)</span>.</p>
<p><strong>Conclusion:</strong> A significant <span class="math inline">\(F\)</span>-statistic indicates that the slopes are not homogeneous, violating a key ANCOVA assumption.</p>
<p><strong>Reference:</strong> Scheffé (1959) elaborates on hypothesis testing for interaction terms in ANCOVA.</p>
</section>
</section>
<section id="confidence-intervals-for-higher-order-contrasts" class="level2">
<h2 class="anchored" data-anchor-id="confidence-intervals-for-higher-order-contrasts">Confidence Intervals for Higher-Order Contrasts</h2>
<p>For higher-order interactions involving multiple factors, <strong>confidence intervals for contrasts</strong> provide insights into the magnitude and significance of these interactions.</p>
<section id="formula-2" class="level3">
<h3 class="anchored" data-anchor-id="formula-2">Formula</h3>
<p><span class="math display">\[
\text{CI} = \hat{L} \pm t_{\alpha/2, df} \sqrt{\text{Var}(\hat{L})}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\hat{L}\)</span>: Estimated contrast.</li>
<li><span class="math inline">\(t_{\alpha/2, df}\)</span>: Critical value from the t-distribution.</li>
<li><span class="math inline">\(\text{Var}(\hat{L})\)</span>: Variance of the contrast estimate.</li>
</ul>
</section>
<section id="steps-in-r" class="level3">
<h3 class="anchored" data-anchor-id="steps-in-r">Steps in R</h3>
<ol type="1">
<li><p><strong>Estimate the Contrast:</strong> Using the <code>emmeans</code> package to define and estimate contrasts.</p></li>
<li><p><strong>Calculate the Confidence Interval:</strong> The <code>emmeans</code> package automatically provides confidence intervals when performing contrasts.</p></li>
</ol>
</section>
<section id="example-2" class="level3">
<h3 class="anchored" data-anchor-id="example-2">Example:</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the ANCOVA model</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> Treatment <span class="sc">+</span> X, <span class="at">data =</span> data_sim)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define estimated marginal means</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(model, <span class="sc">~</span>Treatment)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a contrast (e.g., Treatment B vs. Treatment A)</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>contrast_AB <span class="ot">&lt;-</span> <span class="fu">contrast</span>(emm, <span class="at">method =</span> <span class="st">"pairwise"</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(contrast_AB, <span class="at">infer =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="interpretation-2" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-2">Interpretation:</h3>
<p>The output provides the estimated difference, standard error, t-value, and confidence interval for the contrast. If the confidence interval does not include zero, the contrast is statistically significant.</p>
<p><strong>Reference:</strong> Christensen (2018) discusses confidence intervals for contrasts in <em>Analysis of Variance, Design, and Regression</em>.</p>
</section>
</section>
<section id="conclusion-1" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-1">Conclusion</h2>
<p><strong>Complete Block Designs (CBDs)</strong>, particularly <strong>Randomized Complete Block Designs (RCBDs)</strong>, are invaluable in experimental research for controlling variability due to nuisance factors. By structuring experiments to include blocks where each treatment is represented, CBDs enhance the precision and reliability of treatment effect estimates. The integration of ANOVA facilitates robust analysis, allowing researchers to discern meaningful differences among treatments while accounting for block-induced variability.</p>
</section>
<section id="key-takeaways-1" class="level2">
<h2 class="anchored" data-anchor-id="key-takeaways-1">Key Takeaways</h2>
<ul>
<li><strong>Blocking:</strong> Reduces variability from known sources, increasing the efficiency of treatment comparisons.</li>
<li><strong>ANOVA in RCBDs:</strong> Decomposes variability to isolate treatment effects, providing a clear framework for hypothesis testing.</li>
<li><strong>General Complete Block Designs:</strong> Extend the utility of CBDs to more complex scenarios involving treatment replications within blocks.</li>
<li><strong>Practical Implementation:</strong> R offers comprehensive tools for designing, analyzing, and interpreting CBDs, empowering researchers with robust statistical capabilities.</li>
<li><strong>Advanced Topics:</strong> Understanding interactions and sample size considerations enhances the depth and applicability of CBDs in diverse research contexts.</li>
</ul>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ol type="1">
<li>Dean, A., Voss, D., &amp; Draguljić, D. (2017). <em>Design and Analysis of Experiments</em>. Springer.</li>
<li>Montgomery, D. C., &amp; Runger, G. C. (2010). <em>Applied Statistics and Probability for Engineers</em>. Wiley.</li>
<li>Christensen, R. (2018). <em>Analysis of Variance, Design, and Regression</em>. Chapman and Hall/CRC.</li>
<li>Kempthorne, O. (1977). <em>Design and Analysis of Experiments</em>. Robert E. Krieger Publishing Company.</li>
<li>Scheffé, H. (1959). <em>The Analysis of Variance</em>. Wiley.</li>
</ol>


</section>
</section>

</main> <!-- /main -->
<!-- filepath: /Users/dt/Library/CloudStorage/Dropbox/Teaching/DOE/assets/includes/footer.html -->
<footer class="site-footer">
    <div class="container text-center">
        <hr> 
        © <span id="current-year"></span> Dr. Davood Tofighi |
        <a href="https://canvasinfo.unm.edu/">UNM Canvas</a> |
        <a href="https://data-wise.github.io/doe">Course GitHub Page</a> |
    </div>
    <script>
        document.getElementById("current-year").textContent = new Date().getFullYear();
    </script>
</footer>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/Data-Wise\.github\.io\/doe\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>