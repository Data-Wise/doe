<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.41">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Davood Tofighi, Ph.D.">

<title>Factorial ANOVA – STAT 454/545 - Analysis of Variance and Experimental Design</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/images/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-48ffa3e5b9d089919c6712c39e5b00f2.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-79108a0fc1995748cbd19a5b0e3e3e7c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Factorial ANOVA – STAT 454/545 - Analysis of Variance and Experimental Design">
<meta property="og:description" content="Analysis of Variance and Experimental Design">
<meta property="og:image" content="https://Data-Wise.github.io/doe/slides/data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==">
<meta property="og:site_name" content="STAT 454/545 - Analysis of Variance and Experimental Design">
</head>

<body class="nav-sidebar floating nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">STAT 545</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus/syllabus-final.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_lectures.html"> 
<span class="menu-text">Lecture Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus/schedule.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_assignments.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../r_help.html"> 
<span class="menu-text">R Help</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_appendix.html"> 
<span class="menu-text">Appendix</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../contents.html"> 
<span class="menu-text">Contents</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Factorial ANOVA</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Course Overview</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syllabus/syllabus-final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syllabus/schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Course Materials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../home_lectures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture Notes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../home_assignments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignments</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">R Code and Datasets</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../r_help.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Help</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../r-code-data-book.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Code and Datasets from the Book</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data-files-book.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datasets from the Book</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Resources</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../home_appendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../contents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contents</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Factorial ANOVA</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://Data-Wise.github.io/doe">Davood Tofighi, Ph.D.</a> <a href="mailto:dtofighi@unm.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0001-8523-7776" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Department of Mathematics and Statistics, University of New Mexico
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<ol type="1">
<li><strong>Purpose</strong>:
<ul>
<li>Explore the structure of a <strong>two-factor factorial ANOVA</strong> and interpret main/interaction effects.</li>
<li>Demonstrate how to <strong>implement and interpret</strong> the analysis in R using <strong><code>emmeans</code></strong>.</li>
</ul></li>
<li><strong>Key Concepts</strong>:
<ul>
<li>Main effects, interaction, model assumptions, balanced vs.&nbsp;unbalanced data.</li>
<li>Sums of squares (Type I, Type II, Type III).</li>
<li>Post hoc comparisons with <strong><code>emmeans</code></strong>.</li>
</ul></li>
</ol>
</section>
</section>
<section id="r-packages-and-tools" class="level1">
<h1>R Packages and Tools</h1>
<section id="r-packages-overview" class="level2">
<h2 class="anchored" data-anchor-id="r-packages-overview">R Packages Overview</h2>
<p>We use several packages to manage data, create visualizations, and conduct diagnostics:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    dplyr, <span class="co"># Data manipulation</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    ggplot2, <span class="co"># Data visualization</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    here, <span class="co"># File path management</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    readr, <span class="co"># Data import</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    MASS, <span class="co"># Statistical functions including boxcox()</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    car, <span class="co"># Diagnostic plots and tests</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    cowplot, <span class="co"># Plotting functions</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    emmeans <span class="co"># Post hoc comparisons</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(cowplot<span class="sc">::</span><span class="fu">theme_cowplot</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><strong>Explanation:</strong>
<ul>
<li><strong>dplyr:</strong> For data manipulation.<br>
</li>
<li><strong>ggplot2:</strong> For creating high-quality plots.<br>
</li>
<li><strong>here:</strong> For consistent file paths.<br>
</li>
<li><strong>readr:</strong> For fast and efficient data reading.<br>
</li>
<li><strong>MASS:</strong> For advanced statistical methods (e.g., Box-Cox transformation).<br>
</li>
<li><strong>nlme:</strong> For modeling non-independent data (e.g., mixed-effects models).</li>
</ul></li>
</ul>
</section>
</section>
<section id="experimental-scenario" class="level1">
<h1>Experimental Scenario</h1>
<section id="example-motivation" class="level2">
<h2 class="anchored" data-anchor-id="example-motivation">Example Motivation</h2>
<p>We will use a hypothetical <strong>Battery Life Experiment</strong> with two factors:</p>
<ul>
<li><strong>Factor A (Type of Battery)</strong>: Alkaline vs.&nbsp;Heavy Duty</li>
<li><strong>Factor B (Brand)</strong>: Name Brand vs.&nbsp;Store Brand</li>
</ul>
<p>We collect data in a <strong>2×2 factorial</strong> arrangement. Each cell (combination) has 3 replicates (this is a balanced design of size <span class="math inline">\(r_{ij} = 3\)</span>).</p>
<p><strong>Data sketch</strong> (fictitious numbers):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: right;">Battery Type</th>
<th style="text-align: right;">Brand</th>
<th>Observations (Battery Life in hours)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">Alkaline</td>
<td style="text-align: right;">Name Brand</td>
<td>32.1, 33.3, 31.9</td>
</tr>
<tr class="even">
<td style="text-align: right;">Alkaline</td>
<td style="text-align: right;">Store Brand</td>
<td>28.7, 29.1, 29.3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">Heavy Duty</td>
<td style="text-align: right;">Name Brand</td>
<td>25.5, 26.1, 25.7</td>
</tr>
<tr class="even">
<td style="text-align: right;">Heavy Duty</td>
<td style="text-align: right;">Store Brand</td>
<td>20.2, 20.6, 21.1</td>
</tr>
</tbody>
</table>
</section>
<section id="reading-data-in-r" class="level2">
<h2 class="anchored" data-anchor-id="reading-data-in-r">Reading Data in R</h2>
</section>
<section id="two-way-factorial-anova" class="level2">
<h2 class="anchored" data-anchor-id="two-way-factorial-anova">Two-Way Factorial ANOVA</h2>
</section>
<section id="model-setup" class="level2">
<h2 class="anchored" data-anchor-id="model-setup">Model Setup</h2>
<p>Given two factors <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>:</p>
<ul>
<li><span class="math inline">\(A\)</span> has <span class="math inline">\(a\)</span> levels (e.g., 2 types of batteries).</li>
<li><span class="math inline">\(B\)</span> has <span class="math inline">\(b\)</span> levels (e.g., 2 brands).</li>
<li><span class="math inline">\(r\)</span> replicates in each combination (balanced scenario).</li>
</ul>
<p><strong>Two-way complete model</strong> (with interaction):</p>
<p><span class="math display">\[
y_{ijt} \;=\; \mu + \alpha_i + \beta_j + (\alpha\beta)_{ij} + \varepsilon_{ijt},
\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(y_{ijt}\)</span> is the <span class="math inline">\(t\)</span>-th observation in the cell <span class="math inline">\((i,j)\)</span>,</li>
<li><span class="math inline">\(\alpha_i\)</span> is the main effect of factor <span class="math inline">\(A\)</span> level <span class="math inline">\(i\)</span>,</li>
<li><span class="math inline">\(\beta_j\)</span> is the main effect of factor <span class="math inline">\(B\)</span> level <span class="math inline">\(j\)</span>,</li>
<li><span class="math inline">\((\alpha\beta)_{ij}\)</span> is the interaction effect between levels <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>,</li>
<li><span class="math inline">\(\varepsilon_{ijt}\)</span> are i.i.d. <span class="math inline">\(N(0,\sigma^2)\)</span> random errors.</li>
</ul>
<p><strong>Null hypotheses</strong>:</p>
<ol type="1">
<li>Interaction: <span class="math inline">\(H_{0}^{AB}: (\alpha\beta)_{ij} = 0\)</span> for all <span class="math inline">\(i,j\)</span>.</li>
<li>Factor A main effect: <span class="math inline">\(H_{0}^{A}: \alpha_1 = \cdots = \alpha_a = 0\)</span>.</li>
<li>Factor B main effect: <span class="math inline">\(H_{0}^{B}: \beta_1 = \cdots = \beta_b = 0\)</span>.</li>
</ol>
</section>
</section>
<section id="all-about-interaction" class="level1">
<h1>All about Interaction</h1>
<section id="concept-of-interaction" class="level2">
<h2 class="anchored" data-anchor-id="concept-of-interaction">Concept of Interaction</h2>
<p><strong>Definition</strong>: An interaction occurs when the effect of one factor depends on the level of the other factor.</p>
<ul>
<li><em>In literature</em>, Fisher (1926) emphasized that interaction reveals non-additivity among factors. Dean et al.&nbsp;(2017) define interaction as “the failure of factors to combine additively in their effects on the response.”</li>
<li><em>Graphical perspective</em>: If lines in an interaction plot are <strong>not parallel</strong>, an interaction is likely present.</li>
</ul>
<section id="why-interaction-matters" class="level3">
<h3 class="anchored" data-anchor-id="why-interaction-matters">Why Interaction Matters</h3>
<ul>
<li>If significant, you cannot interpret main effects alone.</li>
<li>Must interpret or compare the <strong>cell means</strong> <span class="math inline">\(\mu_{ij}\)</span> directly.</li>
</ul>
</section>
</section>
<section id="scenario-effect-of-diet-and-exercise-on-weight-loss" class="level2">
<h2 class="anchored" data-anchor-id="scenario-effect-of-diet-and-exercise-on-weight-loss">Scenario: Effect of Diet and Exercise on Weight Loss</h2>
<p>Suppose a researcher wants to study the impact of <strong>diet type</strong> and <strong>exercise routine</strong> on weight loss. The two factors are:</p>
<ul>
<li><strong>Factor A: Diet Type</strong>
<ul>
<li><span class="math inline">\(A_1\)</span>: Low-Carb Diet</li>
<li><span class="math inline">\(A_2\)</span>: Low-Fat Diet</li>
</ul></li>
<li><strong>Factor B: Exercise Routine</strong>
<ul>
<li><span class="math inline">\(B_1\)</span>: Cardio Exercise</li>
<li><span class="math inline">\(B_2\)</span>: Strength Training</li>
</ul></li>
</ul>
<p>The response variable is <strong>weight loss (kg) after 3 months</strong>.</p>
</section>
<section id="case-1-no-interaction-additive-effects" class="level2">
<h2 class="anchored" data-anchor-id="case-1-no-interaction-additive-effects">Case 1: No Interaction (Additive Effects)</h2>
<p>If the effects of diet and exercise are purely additive, we might see the following mean weight loss data:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 30%">
<col style="width: 26%">
<col style="width: 25%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Exercise Type</strong></th>
<th><strong>Low-Carb Diet (<span class="math inline">\(A_1\)</span>)</strong></th>
<th><strong>Low-Fat Diet (<span class="math inline">\(A_2\)</span>)</strong></th>
<th><strong>Effect of Diet</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Cardio (<span class="math inline">\(B_1\)</span>)</strong></td>
<td>8 kg</td>
<td>5 kg</td>
<td>3 kg</td>
</tr>
<tr class="even">
<td><strong>Strength Training (<span class="math inline">\(B_2\)</span>)</strong></td>
<td>6 kg</td>
<td>3 kg</td>
<td>3 kg</td>
</tr>
<tr class="odd">
<td><strong>Effect of Exercise</strong></td>
<td>2 kg</td>
<td>2 kg</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="key-observations" class="level2">
<h2 class="anchored" data-anchor-id="key-observations">Key Observations</h2>
<ul>
<li><strong>Main Effect of Diet</strong>: Low-carb results in <strong>3 kg more</strong> weight loss than low-fat <em>on average</em> (marginal means: <span class="math inline">\((8+6)/2 = 7\)</span> vs.&nbsp;<span class="math inline">\((5+3)/2 = 4\)</span>).</li>
<li><strong>Main Effect of Exercise</strong>: Cardio results in <strong>2 kg more</strong> weight loss than strength training <em>on average</em> (marginal means: <span class="math inline">\((8+5)/2 = 6.5\)</span> vs.&nbsp;<span class="math inline">\((6+3)/2 = 4.5\)</span>).</li>
<li><strong>No Interaction</strong>: The effect of diet is consistent across exercise types (difference = 2 kg for both), and the effect of exercise is consistent across diets (difference = 3 kg for both).</li>
</ul>
</section>
<section id="case-2-significant-interaction-non-additive-effects" class="level2">
<h2 class="anchored" data-anchor-id="case-2-significant-interaction-non-additive-effects">Case 2: Significant Interaction (Non-Additive Effects)</h2>
<p>If diet and exercise interact, the results may look different:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 28%">
<col style="width: 25%">
<col style="width: 24%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Exercise Type</strong></th>
<th><strong>Low-Carb Diet (<span class="math inline">\(A_1\)</span>)</strong></th>
<th><strong>Low-Fat Diet (<span class="math inline">\(A_2\)</span>)</strong></th>
<th><strong>Effect of Exercise</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Cardio (<span class="math inline">\(B_1\)</span>)</strong></td>
<td>10 kg</td>
<td>3 kg</td>
<td><strong>7 kg</strong></td>
</tr>
<tr class="even">
<td><strong>Strength Training (<span class="math inline">\(B_2\)</span>)</strong></td>
<td>4 kg</td>
<td>5 kg</td>
<td><strong>-1 kg</strong></td>
</tr>
<tr class="odd">
<td><strong>Effect of Diet</strong></td>
<td><strong>6 kg</strong></td>
<td><strong>-2 kg</strong></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="key-observations-1" class="level2">
<h2 class="anchored" data-anchor-id="key-observations-1">Key Observations:</h2>
<ul>
<li>On a <strong>Low-Carb Diet</strong>, <strong>Cardio</strong> leads to the <strong>highest weight loss (10 kg)</strong>, while Strength Training leads to <strong>much less weight loss (4 kg)</strong>.</li>
<li>On a <strong>Low-Fat Diet</strong>, <strong>Cardio is less effective (3 kg)</strong>, and Strength Training is <strong>slightly better (5 kg)</strong>.</li>
<li><strong>Interaction Effect:</strong> The impact of exercise type <strong>depends on the diet</strong>.
<ul>
<li>Cardio is <strong>very effective</strong> with a Low-Carb Diet (<strong>+10 kg</strong> loss) but <strong>ineffective</strong> with a Low-Fat Diet (<strong>only 3 kg loss</strong>).</li>
<li>Strength Training <strong>performs better</strong> with Low-Fat than Low-Carb Diet.</li>
<li>The simple main effects of diet and exercise <strong>change direction</strong> in different conditions.</li>
</ul></li>
</ul>
</section>
<section id="how-interaction-changes-interpretation" class="level2">
<h2 class="anchored" data-anchor-id="how-interaction-changes-interpretation">How Interaction Changes Interpretation</h2>
<ol type="1">
<li><strong>Without Interaction (Additive Model):</strong>
<ul>
<li>The best strategy would be <strong>Low-Carb Diet</strong> and <strong>Cardio</strong>, assuming effects are independent.</li>
<li>Strength Training would be <strong>equally beneficial</strong> across diets.</li>
</ul></li>
<li><strong>With Interaction (Non-Additive Model):</strong>
<ul>
<li><strong>Cardio only works well with a Low-Carb Diet.</strong></li>
<li><strong>Strength Training works better with a Low-Fat Diet.</strong></li>
<li>Recommending <strong>Cardio to someone on a Low-Fat Diet might be counterproductive</strong>.</li>
<li>If a person prefers <strong>Strength Training</strong>, they might be <strong>better off on a Low-Fat Diet</strong> rather than a Low-Carb Diet.</li>
</ul></li>
</ol>
</section>
<section id="graphical-representation" class="level2">
<h2 class="anchored" data-anchor-id="graphical-representation">Graphical Representation</h2>
<p>If we plot weight loss against <strong>exercise type</strong>, the interaction would appear as <strong>non-parallel lines</strong>:</p>
<ul>
<li><strong>No interaction:</strong> Two parallel lines (consistent gap between exercise types).</li>
<li><strong>Strong interaction:</strong> Lines <strong>cross</strong> or <strong>diverge significantly</strong>, indicating a <strong>change in ranking</strong> of factors.</li>
</ul>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frames for both scenarios</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>no_interaction <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Diet =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Low-Carb"</span>, <span class="st">"Low-Fat"</span>), <span class="at">each =</span> <span class="dv">2</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Exercise =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Cardio"</span>, <span class="st">"Strength"</span>), <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Weight_Loss =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">3</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>with_interaction <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Diet =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Low-Carb"</span>, <span class="st">"Low-Fat"</span>), <span class="at">each =</span> <span class="dv">2</span>),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Exercise =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Cardio"</span>, <span class="st">"Strength"</span>), <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Weight_Loss =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">5</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1: No Interaction</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(no_interaction, <span class="fu">aes</span>(<span class="at">x =</span> Diet, <span class="at">y =</span> Weight_Loss, <span class="at">color =</span> Exercise, <span class="at">group =</span> Exercise)) <span class="sc">+</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Weight Loss (kg)"</span>, <span class="at">title =</span> <span class="st">"No Interaction"</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2: With Interaction</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(with_interaction, <span class="fu">aes</span>(<span class="at">x =</span> Diet, <span class="at">y =</span> Weight_Loss, <span class="at">color =</span> Exercise, <span class="at">group =</span> Exercise)) <span class="sc">+</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Weight Loss (kg)"</span>, <span class="at">title =</span> <span class="st">"Strong Interaction"</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>plot1</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>plot2</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine plots</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co"># cowplot::plot_grid(plot1, plot2, ncol=2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-diet-interaction" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-diet-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-diet-interaction" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-diet-interaction-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-diet-interaction-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="week-05_factorial-anova_files/figure-html/fig-diet-interaction-1.png" class="img-fluid figure-img" data-ref-parent="fig-diet-interaction" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-diet-interaction-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) No Interaction (Additive Effects)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-diet-interaction" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-diet-interaction-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-diet-interaction-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="week-05_factorial-anova_files/figure-html/fig-diet-interaction-2.png" class="img-fluid figure-img" data-ref-parent="fig-diet-interaction" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-diet-interaction-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Significant Interaction (Non-Additive Effects)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diet-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Diet and Exercise Interaction Examples
</figcaption>
</figure>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This example shows how interaction effects significantly impact decision-making. Ignoring interactions could lead to misleading conclusions:</p>
<ul>
<li>A <strong>“best diet” recommendation</strong> without considering exercise type would be <strong>incorrect</strong>.</li>
<li>A <strong>“best exercise” recommendation</strong> without considering diet type would be <strong>misleading</strong>.</li>
</ul>
<p>Thus, <strong>interaction terms are crucial</strong> in <strong>Two-Factor ANOVA</strong> to uncover hidden dependencies between factors and provide accurate interpretations of experimental results.</p>
</section>
</section>
<section id="r-implementation" class="level1">
<h1>R Implementation</h1>
<section id="sample-data-in-r" class="level2">
<h2 class="anchored" data-anchor-id="sample-data-in-r">Sample Data in R</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>battery_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">BatteryType =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Alkaline"</span>, <span class="st">"HeavyDuty"</span>), <span class="at">each =</span> <span class="dv">6</span>),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Brand =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"NameBrand"</span>, <span class="st">"StoreBrand"</span>), <span class="at">times =</span> <span class="dv">2</span>, <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Life =</span> <span class="fu">c</span>(</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="fl">32.1</span>, <span class="fl">33.3</span>, <span class="fl">31.9</span>, <span class="fl">28.7</span>, <span class="fl">29.1</span>, <span class="fl">29.3</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="fl">25.5</span>, <span class="fl">26.1</span>, <span class="fl">25.7</span>, <span class="fl">20.2</span>, <span class="fl">20.6</span>, <span class="fl">21.1</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>battery_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-battery-data" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-battery-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Battery Life Data
</figcaption>
<div aria-describedby="tbl-battery-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="kable-table">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">BatteryType</th>
<th style="text-align: left;">Brand</th>
<th style="text-align: right;">Life</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Alkaline</td>
<td style="text-align: left;">NameBrand</td>
<td style="text-align: right;">32.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alkaline</td>
<td style="text-align: left;">NameBrand</td>
<td style="text-align: right;">33.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alkaline</td>
<td style="text-align: left;">NameBrand</td>
<td style="text-align: right;">31.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alkaline</td>
<td style="text-align: left;">StoreBrand</td>
<td style="text-align: right;">28.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alkaline</td>
<td style="text-align: left;">StoreBrand</td>
<td style="text-align: right;">29.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alkaline</td>
<td style="text-align: left;">StoreBrand</td>
<td style="text-align: right;">29.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HeavyDuty</td>
<td style="text-align: left;">NameBrand</td>
<td style="text-align: right;">25.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">HeavyDuty</td>
<td style="text-align: left;">NameBrand</td>
<td style="text-align: right;">26.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HeavyDuty</td>
<td style="text-align: left;">NameBrand</td>
<td style="text-align: right;">25.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">HeavyDuty</td>
<td style="text-align: left;">StoreBrand</td>
<td style="text-align: right;">20.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HeavyDuty</td>
<td style="text-align: left;">StoreBrand</td>
<td style="text-align: right;">20.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">HeavyDuty</td>
<td style="text-align: left;">StoreBrand</td>
<td style="text-align: right;">21.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>We have 2 (BatteryType) × 2 (Brand) × 3 replicates = 12 observations.</p>
</section>
<section id="model-fitting" class="level2">
<h2 class="anchored" data-anchor-id="model-fitting">Model Fitting</h2>
<p>Use <code>aov()</code> in base R or <code>lm()</code> for a two-way ANOVA with interaction:</p>
<div id="tbl-fit-model" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-fit-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Two-Way ANOVA Model Fitting
</figcaption>
<div aria-describedby="tbl-fit-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>battery_data<span class="sc">$</span>BatteryType <span class="ot">&lt;-</span> <span class="fu">factor</span>(battery_data<span class="sc">$</span>BatteryType)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>battery_data<span class="sc">$</span>Brand <span class="ot">&lt;-</span> <span class="fu">factor</span>(battery_data<span class="sc">$</span>Brand)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>model_full <span class="ot">&lt;-</span> <span class="fu">aov</span>(Life <span class="sc">~</span> BatteryType <span class="sc">*</span> Brand, <span class="at">data =</span> battery_data)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Df Sum Sq Mean Sq F value   Pr(&gt;F)    
BatteryType        1 170.25  170.25 706.934 4.31e-09 ***
Brand              1  54.61   54.61 226.768 3.74e-07 ***
BatteryType:Brand  1   2.25    2.25   9.356   0.0156 *  
Residuals          8   1.93    0.24                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</figure>
</div>
<section id="explanation" class="level3">
<h3 class="anchored" data-anchor-id="explanation">Explanation</h3>
<ul>
<li><code>Life ~ BatteryType * Brand</code> includes both main effects and their interaction.</li>
<li><code>summary(model_full)</code> prints the Type I ANOVA table by default.</li>
</ul>
</section>
</section>
<section id="interpreting-the-significant-interaction-effect-in-two-factor-anova" class="level2">
<h2 class="anchored" data-anchor-id="interpreting-the-significant-interaction-effect-in-two-factor-anova">Interpreting The Significant Interaction Effect in Two-Factor ANOVA</h2>
<p>Since the interaction effect (<span class="math inline">\(p = 0.0156\)</span>) is statistically significant (<span class="math inline">\(p &lt; 0.05\)</span>), we do not interpret the main effects of Battery Type and Brand separately. Instead, we focus on the interaction, which means that the effect of one factor depends on the level of the other factor.</p>
</section>
<section id="interaction-effect-interpretation" class="level2">
<h2 class="anchored" data-anchor-id="interaction-effect-interpretation">Interaction Effect Interpretation</h2>
</section>
<section id="interaction-batterytypebrand-f-9.356-p-0.0156" class="level2">
<h2 class="anchored" data-anchor-id="interaction-batterytypebrand-f-9.356-p-0.0156">Interaction (BatteryType:Brand, <span class="math inline">\(F\)</span> = 9.356, <span class="math inline">\(p\)</span> = 0.0156)</h2>
<ul>
<li>The significant interaction suggests that the impact of Battery Type on Battery Life is different for different Brands.</li>
<li>In other words, the difference between Alkaline and Heavy Duty batteries varies depending on whether the battery is a Name Brand or a Store Brand.</li>
<li>Because the interaction term is significant, we must analyze the individual cell means rather than summarizing the main effects.</li>
</ul>
</section>
<section id="cell-means-group-means-by-factor-levels" class="level2">
<h2 class="anchored" data-anchor-id="cell-means-group-means-by-factor-levels">Cell Means (Group Means by Factor Levels)</h2>
<p>To understand the interaction, we analyze the mean Battery Life for each combination of Battery Type and Brand.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Battery Type</th>
<th>Brand</th>
<th>Mean Battery Life (<span class="math inline">\(\bar{Y}_{ij}\)</span>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Alkaline</td>
<td>Name Brand</td>
<td><span class="math inline">\(\bar{Y}_{11} = 32.0\)</span></td>
</tr>
<tr class="even">
<td>Alkaline</td>
<td>Store Brand</td>
<td><span class="math inline">\(\bar{Y}_{12} = 28.7\)</span></td>
</tr>
<tr class="odd">
<td>Heavy Duty</td>
<td>Name Brand</td>
<td><span class="math inline">\(\bar{Y}_{21} = 25.7\)</span></td>
</tr>
<tr class="even">
<td>Heavy Duty</td>
<td>Store Brand</td>
<td><span class="math inline">\(\bar{Y}_{22} = 20.7\)</span></td>
</tr>
</tbody>
</table>
</section>
<section id="key-observations-from-the-cell-means" class="level2">
<h2 class="anchored" data-anchor-id="key-observations-from-the-cell-means">Key Observations from the Cell Means</h2>
<ul>
<li>Alkaline batteries last longer than Heavy Duty batteries within each brand, but the size of this effect is not the same for both brands.</li>
<li>Name Brand batteries consistently outperform Store Brand batteries, but the gap is larger for Alkaline batteries than for Heavy Duty batteries.</li>
<li>The difference between Alkaline and Heavy Duty is larger for Store Brand (8 hours) than for Name Brand (6.3 hours).</li>
<li>This suggests a non-additive effect, where the difference between battery types depends on the brand.</li>
</ul>
</section>
<section id="calculating-the-interaction-effect" class="level2">
<h2 class="anchored" data-anchor-id="calculating-the-interaction-effect">Calculating the Interaction Effect</h2>
<p>Mathematically, the interaction effect can be computed as:</p>
<p><span class="math display">\[
\text{Interaction Effect} = (\bar{Y}_{11} - \bar{Y}_{12}) - (\bar{Y}_{21} - \bar{Y}_{22})
\]</span> <span class="math display">\[
= (32.0 - 28.7) - (25.7 - 20.7)
\]</span> <span class="math display">\[
= 3.3 - 5.0
\]</span> <span class="math display">\[
= -1.7
\]</span></p>
<section id="what-this-means" class="level3">
<h3 class="anchored" data-anchor-id="what-this-means">What This Means:</h3>
<ul>
<li>The difference between Alkaline and Heavy Duty batteries is not the same across brands.</li>
<li>The gap is larger for Store Brand batteries than for Name Brand batteries.</li>
<li>The negative interaction effect (-1.7) means that the effect of Battery Type is slightly weaker for Name Brand batteries compared to Store Brand batteries.</li>
</ul>
</section>
</section>
<section id="graphical-representation-1" class="level2">
<h2 class="anchored" data-anchor-id="graphical-representation-1">Graphical Representation</h2>
<p>A graphical interaction plot** helps visualize the effect:</p>
<div class="cell" data-output-location="slide">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">interaction.plot</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">x.factor     =</span> battery_data<span class="sc">$</span>BatteryType,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">trace.factor =</span> battery_data<span class="sc">$</span>Brand,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">response     =</span> battery_data<span class="sc">$</span>Life,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">type         =</span> <span class="st">"b"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">pch          =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span>),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">col          =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab         =</span> <span class="st">"Battery Type"</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab         =</span> <span class="st">"Mean Battery Life"</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">trace.label  =</span> <span class="st">"Brand"</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-interaction-plot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-interaction-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="week-05_factorial-anova_files/figure-html/fig-interaction-plot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-interaction-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Interaction Plot for Battery Life
</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li>If lines cross or deviate from parallel, that supports the significant interaction.</li>
</ul>
</section>
<section id="expected-patterns" class="level2">
<h2 class="anchored" data-anchor-id="expected-patterns">Expected Patterns:</h2>
<ul>
<li><strong>Parallel Lines</strong> → No interaction (the effect of one factor is consistent across levels of the other).</li>
<li><strong>Non-Parallel Lines</strong> → Interaction present (the effect of one factor changes based on the other).</li>
<li><strong>Lines Crossing</strong> → Strong interaction (e.g., one factor reverses the effect of the other).</li>
</ul>
<p>Since the interaction is significant, we expect <strong>the lines to be non-parallel</strong>, indicating that the difference in battery life between Alkaline and Heavy Duty depends on the brand.</p>
</section>
<section id="conclusion-1" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-1">Conclusion</h2>
<ol type="1">
<li>The significant interaction means that the effect of Battery Type depends on Brand.</li>
<li>Because of this, we cannot interpret the main effects of Battery Type and Brand separately.</li>
<li>The interaction suggests that the advantage of Alkaline over Heavy Duty is greater for Store Brand than for Name Brand.</li>
<li>A significant interaction in factorial ANOVA tells us that combining factors leads to a unique outcome that cannot be explained by each factor individually.</li>
<li>A graphical interaction plot can help confirm and visualize this relationship.</li>
</ol>
</section>
</section>
<section id="interpretation-of-results" class="level1">
<h1>Interpretation of Results</h1>
<section id="example-findings" class="level2">
<h2 class="anchored" data-anchor-id="example-findings">Example Findings</h2>
<p>Suppose the ANOVA indicates:</p>
<ul>
<li><strong>Interaction</strong>: F(1,8) = 5.56, p = 0.028 → <em>significant</em>.</li>
<li><strong>BatteryType</strong> main effect: p &lt; 0.001 → <em>significant effect</em> of type.</li>
<li><strong>Brand</strong> main effect: p = 0.004 → <em>significant effect</em> of brand.</li>
</ul>
<p>But because the interaction is significant, discussing main effects in isolation can be misleading.</p>
</section>
</section>
<section id="post-hoc-comparisons-with-emmeans" class="level1">
<h1>Post Hoc Comparisons with <code>emmeans</code></h1>
<section id="why-emmeans" class="level2">
<h2 class="anchored" data-anchor-id="why-emmeans">Why <code>emmeans</code>?</h2>
<ul>
<li><em>Estimated Marginal Means</em> (a.k.a. least-squares means).</li>
<li>Allows flexible pairwise tests or custom contrasts, controlling familywise error rates (Tukey, Bonferroni, etc.).</li>
</ul>
<div class="cell" data-tbl-cap="Estimated Marginal Means for Battery Life">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtain estimated marginal means for each cell combination</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>emm_full <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(model_full, <span class="sc">~</span> BatteryType <span class="sc">*</span> Brand)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>emm_full</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> BatteryType Brand      emmean    SE df lower.CL upper.CL
 Alkaline    NameBrand    32.4 0.283  8     31.8     33.1
 HeavyDuty   NameBrand    25.8 0.283  8     25.1     26.4
 Alkaline    StoreBrand   29.0 0.283  8     28.4     29.7
 HeavyDuty   StoreBrand   20.6 0.283  8     20.0     21.3

Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pairwise comparisons among the 4 combos</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(emm_full, <span class="at">adjust =</span> <span class="st">"tukey"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                                   estimate    SE df t.ratio p.value
 Alkaline NameBrand - HeavyDuty NameBrand       6.67 0.401  8  16.638  &lt;.0001
 Alkaline NameBrand - Alkaline StoreBrand       3.40 0.401  8   8.485  0.0001
 Alkaline NameBrand - HeavyDuty StoreBrand     11.80 0.401  8  29.449  &lt;.0001
 HeavyDuty NameBrand - Alkaline StoreBrand     -3.27 0.401  8  -8.153  0.0002
 HeavyDuty NameBrand - HeavyDuty StoreBrand     5.13 0.401  8  12.811  &lt;.0001
 Alkaline StoreBrand - HeavyDuty StoreBrand     8.40 0.401  8  20.964  &lt;.0001

P value adjustment: tukey method for comparing a family of 4 estimates </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If the interaction is significant, these combos are more relevant</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># than separate main effects alone.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Interpretation</strong>:</p>
<ol type="1">
<li><code>emm_full</code> yields the model-based means for each <span class="math inline">\((A,B)\)</span> cell.</li>
<li><code>pairs(emm_full, adjust="tukey")</code> compares all pairs of the 4 combos with Tukey-corrected p-values.</li>
</ol>
</section>
</section>
<section id="contrasts" class="level1">
<h1>Contrasts</h1>
<p>In the analysis of variance (ANOVA), a <strong>contrast</strong> is a linear combination of treatment means that allows specific comparisons to be made. Contrasts are useful for testing hypotheses about main effects and interactions in factorial experiments.</p>
<p>In factorial designs, contrasts fall into three main categories:</p>
<ul>
<li><strong>Treatment Contrasts</strong>: Comparisons between individual treatment combinations.</li>
<li><strong>Interaction Contrasts</strong>: Assessments of whether interaction effects exist between factors.</li>
<li><strong>Main Effect Contrasts</strong>: Comparisons of the average effects of factor levels, marginalizing over other factors.</li>
</ul>
<section id="relationship-between-mu-and-tau" class="level2">
<h2 class="anchored" data-anchor-id="relationship-between-mu-and-tau">Relationship Between <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau\)</span></h2>
<p>In ANOVA, we distinguish between the observed <strong>treatment means</strong> (denoted by <span class="math inline">\(\mu_{ij}\)</span>) and the corresponding <strong>treatment effects</strong> (denoted by <span class="math inline">\(\tau_{ij}\)</span>). The relationship between these two is given by:</p>
<p><span class="math display">\[
\mu_{ij} = \mu + \tau_{ij}
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\mu\)</span> is the overall mean across all treatments.</li>
<li><span class="math inline">\(\tau_{ij}\)</span> represents the deviation of the specific treatment mean <span class="math inline">\(\mu_{ij}\)</span> from the overall mean.</li>
</ul>
<p>Thus, <span class="math inline">\(\tau_{ij}\)</span> captures the effect of a particular treatment combination relative to the overall mean. When constructing contrasts, we use <span class="math inline">\(\tau_{ij}\)</span> for comparisons between treatments because it isolates the effect of the treatment apart from the grand mean.</p>
</section>
<section id="treatment-contrasts" class="level2">
<h2 class="anchored" data-anchor-id="treatment-contrasts">Treatment Contrasts</h2>
<p>Treatment contrasts involve pairwise comparisons of specific treatment combinations. If we denote treatment effects as <span class="math inline">\(\tau_{ij}\)</span> for factor levels <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, an example of a treatment contrast would be:</p>
<p><span class="math display">\[
\tau_{ij} - \tau_{sh}
\]</span></p>
<p>This contrast represents the difference between treatment combinations <span class="math inline">\((i, j)\)</span> and <span class="math inline">\((s, h)\)</span>. Confidence intervals and hypothesis tests for these contrasts can be conducted using standard ANOVA methods.</p>
</section>
<section id="interaction-contrasts" class="level2">
<h2 class="anchored" data-anchor-id="interaction-contrasts">Interaction Contrasts</h2>
<p>Interaction contrasts measure whether the effect of one factor depends on the level of another factor. A strong interaction is indicated when the effect of a factor changes depending on the level of another factor.</p>
<p>For example, an interaction contrast can be expressed as:</p>
<p><span class="math display">\[
(\tau_{sh} - \tau_{(s+1)h}) - (\tau_{sq} - \tau_{(s+1)q})
\]</span></p>
<p>This contrast checks whether the change in treatment effect from <span class="math inline">\(s\)</span> to <span class="math inline">\(s+1\)</span> for one level of factor <span class="math inline">\(B\)</span> (e.g., <span class="math inline">\(h\)</span>) is the same as the change for another level of factor <span class="math inline">\(B\)</span> (e.g., <span class="math inline">\(q\)</span>).</p>
<p>By substituting the full two-way model <span class="math inline">\(\tau_{ij} = \alpha_i + \beta_j + (\alpha \beta)_{ij}\)</span>, we obtain:</p>
<p><span class="math display">\[
\left( (\alpha \beta )_{sh} - (\alpha \beta )_{(s+1)h}\right) - \left( (\alpha \beta )_{sq} - (\alpha \beta )_{(s+1)q}\right)
\]</span></p>
<p>This expression consists only of interaction terms, confirming that it is an interaction contrast.</p>
</section>
<section id="numerical-example-interaction-contrast" class="level2">
<h2 class="anchored" data-anchor-id="numerical-example-interaction-contrast">Numerical Example: Interaction Contrast</h2>
<p>Consider an experiment with two factors: <strong>Diet Type (A: Standard or High-Protein)</strong> and <strong>Exercise Level (B: Low or High)</strong>. The treatment means for the four combinations are:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Diet (A)</th>
<th>Exercise (B)</th>
<th>Mean Response (<span class="math inline">\(\mu_{ij}\)</span>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Standard</td>
<td>Low</td>
<td>50</td>
</tr>
<tr class="even">
<td>Standard</td>
<td>High</td>
<td>55</td>
</tr>
<tr class="odd">
<td>High-Protein</td>
<td>Low</td>
<td>60</td>
</tr>
<tr class="even">
<td>High-Protein</td>
<td>High</td>
<td>70</td>
</tr>
</tbody>
</table>
<p>The interaction contrast is:</p>
<p><span class="math display">\[
(\mu_{11} - \mu_{12}) - (\mu_{21} - \mu_{22})
\]</span></p>
<p>Substituting the values:</p>
<p><span class="math display">\[
(50 - 55) - (60 - 70) = (-5) - (-10) = 5
\]</span></p>
<p>This result suggests that the effect of diet type depends on the level of exercise, indicating an interaction between the factors.</p>
</section>
<section id="interaction-contrasts-in-anova" class="level2">
<h2 class="anchored" data-anchor-id="interaction-contrasts-in-anova">Interaction Contrasts in ANOVA</h2>
<p>Interaction contrasts always take the form:</p>
<p><span class="math display">\[
\sum_i \sum_j d_{ij} \tau_{ij} = \sum_i \sum_j d_{ij} (\alpha \beta )_{ij}
\]</span></p>
<p>where the contrast coefficients satisfy:</p>
<p><span class="math display">\[
\sum_i d_{ij} = 0 \quad \text{for each } j, \quad \sum_j d_{ij} = 0 \quad \text{for each } i.
\]</span></p>
</section>
<section id="main-effect-contrasts" class="level2">
<h2 class="anchored" data-anchor-id="main-effect-contrasts">Main Effect Contrasts</h2>
<p>When interaction effects are small or negligible, main effect contrasts provide meaningful comparisons. Main effects describe the average response for each level of a factor, averaged over the levels of the other factor(s).</p>
<p>A main effect contrast for factor <span class="math inline">\(A\)</span> is given by:</p>
<p><span class="math display">\[
\sum_i c_i \overline{\tau }_{i.} = \sum_i c_i (\alpha_i + (\overline{\alpha \beta })_{i.})
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
(\overline{\alpha \beta })_{i.} = \frac{1}{b} \sum_j (\alpha \beta )_{ij}
\]</span></p>
<p>represents the average interaction effect over all levels of <span class="math inline">\(B\)</span>. Since interactions are averaged out, the main effect contrasts focus on the individual contribution of factor <span class="math inline">\(A\)</span>.</p>
</section>
<section id="main-effect-contrasts-for-factor-b" class="level2">
<h2 class="anchored" data-anchor-id="main-effect-contrasts-for-factor-b">Main Effect Contrasts for Factor B</h2>
<p>Similarly, the main effect contrast for factor <span class="math inline">\(B\)</span> is:</p>
<p><span class="math display">\[
\begin{align*}
\sum_j k_j \overline{\tau }_{.j} &amp;= \sum_j k_j (\eta_j + (\overline{\alpha \beta })_{.j}) \\
&amp;= \sum_j k_j \beta^*_j
\end{align*}
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
\sum k_j = 0, \quad (\overline{\alpha \beta })_{.j} = \frac{1}{a} \sum_i (\alpha \beta )_{ij}.
\]</span></p>
</section>
<section id="simple-contrasts-and-simple-pairwise-differences" class="level2">
<h2 class="anchored" data-anchor-id="simple-contrasts-and-simple-pairwise-differences">Simple Contrasts and Simple Pairwise Differences</h2>
<p>Sometimes, it is useful to compare factor levels within a specific level of another factor. These are known as <strong>simple contrasts</strong>.</p>
<p>A simple contrast takes the form:</p>
<p><span class="math display">\[
\sum_j c_j \tau_{ij} \quad \text{with } \sum_j c_j=0 \text{ for each } i.
\]</span></p>
<p>A special case is the <strong>simple pairwise difference</strong>, which compares two levels of <span class="math inline">\(B\)</span> within each level of <span class="math inline">\(A\)</span>:</p>
<p><span class="math display">\[
\tau_{ih}-\tau_{ij}, \quad \text{for each } i=1,\ldots , a.
\]</span></p>
</section>
</section>
<section id="writing-contrasts-as-coefficient-lists" class="level1">
<h1>Writing Contrasts as Coefficient Lists</h1>
<section id="intuitive-understanding" class="level3">
<h3 class="anchored" data-anchor-id="intuitive-understanding">Intuitive Understanding</h3>
<p>A contrast is a linear combination of treatment means or effects that sum to zero and is used to test specific hypotheses in an experimental design. Instead of explicitly writing out the mathematical contrast expressions, it is often more convenient to list only the contrast coefficients. These coefficient lists specify how each treatment combination contributes to the contrast.</p>
<p>For example, in a <strong>two-way ANOVA</strong> with factors <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>, contrasts can be written in terms of:</p>
<ul>
<li>The coefficients assigned to each parameter (<span class="math inline">\(\alpha_i^*\)</span>, <span class="math inline">\(\beta_j^*\)</span>, and interaction terms <span class="math inline">\((\alpha\beta)_{ij}\)</span>), or</li>
<li>Directly in terms of the treatment combinations (<span class="math inline">\(\tau_{ij}\)</span>).</li>
</ul>
<p>Using coefficient lists simplifies computations and allows for easy formulation of interaction and main-effect contrasts.</p>
</section>
<section id="defining-contrasts-in-a-two-way-anova" class="level2">
<h2 class="anchored" data-anchor-id="defining-contrasts-in-a-two-way-anova">Defining Contrasts in a Two-Way ANOVA</h2>
<ol type="1">
<li><strong>Main-Effect Contrast for Factor <span class="math inline">\(A\)</span>:</strong></li>
</ol>
<p><span class="math display">\[
\sum_i c_i \overline{\tau }_{i.} = \sum_i c_i \alpha_i, \quad \text{with} \quad \sum c_i = 0.
\]</span></p>
<ol start="2" type="1">
<li><strong>Main-Effect Contrast for Factor <span class="math inline">\(B\)</span>:</strong></li>
</ol>
<p><span class="math display">\[
\sum_j k_j \overline{\tau }_{.j} = \sum_j k_j \beta_j, \quad \text{with} \quad \sum k_j = 0.
\]</span></p>
<ol start="3" type="1">
<li><strong>Interaction Contrast:</strong></li>
</ol>
<p><span class="math display">\[
\tau_{11} - \tau_{12} - \tau_{21} + \tau_{22} = (\alpha \beta )_{11} - (\alpha \beta )_{12} -(\alpha \beta )_{21} + (\alpha \beta )_{22}.
\]</span></p>
<p>This interaction contrast can be represented by the coefficient list:</p>
<p><span class="math display">\[
[1, -1, -1, 1].
\]</span></p>
</section>
<section id="example-battery-experiment" class="level2">
<h2 class="anchored" data-anchor-id="example-battery-experiment">Example: Battery Experiment</h2>
<p>Consider an experiment with two factors:</p>
<ul>
<li><strong>Duty:</strong> Alkaline (1) vs.&nbsp;Heavy Duty (2)</li>
<li><strong>Brand:</strong> Name Brand (1) vs.&nbsp;Store Brand (2)</li>
</ul>
<p>The treatment combinations and mean response times (battery lifespan in hours) are:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Duty</th>
<th>Brand</th>
<th>Mean Lifespan (hours)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1 (Alkaline)</td>
<td>1 (Name Brand)</td>
<td>45</td>
</tr>
<tr class="even">
<td>1 (Alkaline)</td>
<td>2 (Store Brand)</td>
<td>40</td>
</tr>
<tr class="odd">
<td>2 (Heavy Duty)</td>
<td>1 (Name Brand)</td>
<td>35</td>
</tr>
<tr class="even">
<td>2 (Heavy Duty)</td>
<td>2 (Store Brand)</td>
<td>30</td>
</tr>
</tbody>
</table>
<ul>
<li>The contrast comparing <strong>Heavy Duty vs.&nbsp;Alkaline</strong> (averaged across brands) has coefficient list:</li>
</ul>
<p><span class="math display">\[
[-1, -1, 1, 1]
\]</span></p>
<p>in terms of the effects <span class="math inline">\(\tau_{ij}\)</span>.</p>
<ul>
<li>Similarly, the contrast comparing <strong>Store Brand vs.&nbsp;Name Brand</strong> has coefficient list:</li>
</ul>
<p><span class="math display">\[
[-1, 1, -1, 1]
\]</span></p>
<p>in terms of <span class="math inline">\(\tau_{ij}\)</span>.</p>
</section>
</section>
<section id="r-code-using-emmeans" class="level1">
<h1>R Code Using <code>emmeans</code></h1>
<p>We’ll analyze the example using <code>lm()</code> and <code>emmeans</code> in R to compute estimated marginal means (EMMs) and test contrasts.</p>
<section id="step-1-simulate-data-and-fit-anova-model" class="level2">
<h2 class="anchored" data-anchor-id="step-1-simulate-data-and-fit-anova-model">Step 1: Simulate Data and Fit ANOVA Model</h2>
<p>We already fit the model.</p>
</section>
<section id="step-2-compute-estimated-marginal-means-emms" class="level2">
<h2 class="anchored" data-anchor-id="step-2-compute-estimated-marginal-means-emms">Step 2: Compute Estimated Marginal Means (EMMs)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get estimated marginal means</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>emm_full</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> BatteryType Brand      emmean    SE df lower.CL upper.CL
 Alkaline    NameBrand    32.4 0.283  8     31.8     33.1
 HeavyDuty   NameBrand    25.8 0.283  8     25.1     26.4
 Alkaline    StoreBrand   29.0 0.283  8     28.4     29.7
 HeavyDuty   StoreBrand   20.6 0.283  8     20.0     21.3

Confidence level used: 0.95 </code></pre>
</div>
</div>
<p>This output confirms the order of the estimated marginal means.</p>
</section>
</section>
<section id="step-3-define-and-test-contrasts" class="level1">
<h1>Step 3: Define and Test Contrasts</h1>
<section id="contrast-for-heavy-duty-vs.-alkaline" class="level2">
<h2 class="anchored" data-anchor-id="contrast-for-heavy-duty-vs.-alkaline">Contrast For “Heavy Duty vs.&nbsp;Alkaline”</h2>
<p>Assigning Contrast Coefficients Based on Order: To compare the main effect of <strong>Duty</strong>, we use:</p>
<p><span class="math display">\[
\text{Contrast} = (-1, +1, -1, +1)
\]</span></p>
<p>where:</p>
<ul>
<li><strong>Alkaline (NameBrand)</strong> = -1</li>
<li><strong>HeavyDuty (NameBrand)</strong> = +1</li>
<li><strong>Alkaline (StoreBrand)</strong> = -1</li>
<li><strong>HeavyDuty (StoreBrand)</strong> = +1</li>
</ul>
<p>The coefficients for a contrast must be aligned with the order of the means shown in <code>emmeans</code>.</p>
<div id="tbl-contrast-alk-vs-heavy" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-contrast-alk-vs-heavy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Contrast for Heavy Duty vs.&nbsp;Alkaline
</figcaption>
<div aria-describedby="tbl-contrast-alk-vs-heavy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrast</span>(emm_full, <span class="fu">list</span>(<span class="at">Duty_Contrast =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast      estimate    SE df t.ratio p.value
 Duty_Contrast    -15.1 0.567  8 -26.588  &lt;.0001</code></pre>
</div>
</div>
</figure>
</div>
</section>
<section id="contrast-for-store-brand-vs.-name-brand" class="level2">
<h2 class="anchored" data-anchor-id="contrast-for-store-brand-vs.-name-brand">Contrast For “Store Brand vs.&nbsp;Name Brand”</h2>
<p>To compare <strong>Brand</strong>, use:</p>
<p><span class="math display">\[
\text{Contrast} = (-1, +1, -1, +1)
\]</span></p>
<p>where:</p>
<ul>
<li><strong>NameBrand (Alkaline)</strong> = -1</li>
<li><strong>NameBrand (HeavyDuty)</strong> = -1</li>
<li><strong>StoreBrand (Alkaline)</strong> = +1</li>
<li><strong>StoreBrand (HeavyDuty)</strong> = +1</li>
</ul>
<div id="tbl-contrast-store-vs-name" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-contrast-store-vs-name-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Contrast for Store Brand vs.&nbsp;Name Brand
</figcaption>
<div aria-describedby="tbl-contrast-store-vs-name-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrast</span>(emm_full, <span class="fu">list</span>(<span class="at">Brand_Contrast =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast       estimate    SE df t.ratio p.value
 Brand_Contrast    -8.53 0.567  8 -15.059  &lt;.0001</code></pre>
</div>
</div>
</figure>
</div>
</section>
<section id="interaction-contrast" class="level2">
<h2 class="anchored" data-anchor-id="interaction-contrast">Interaction Contrast</h2>
<p>To test for an interaction effect, we look at:</p>
<p><span class="math display">\[
\text{Interaction Contrast} = (1, -1, 1, -1)
\]</span></p>
<ul>
<li><strong>NameBrand (Alkaline)</strong> = 1</li>
<li><strong>NameBrand (HeavyDuty)</strong> = -1</li>
<li><strong>StoreBrand (Alkaline)</strong> = +1</li>
<li><strong>StoreBrand (HeavyDuty)</strong> = -1</li>
</ul>
<p>This contrast tests whether the difference between <strong>Duty</strong> is consistent across <strong>Brand</strong>.</p>
<div id="tbl-contrast-interaction" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-contrast-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5: Interaction Contrast
</figcaption>
<div aria-describedby="tbl-contrast-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrast</span>(emm_full, <span class="fu">list</span>(<span class="at">Interaction_Contrast =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast             estimate    SE df t.ratio p.value
 Interaction_Contrast     15.1 0.567  8  26.588  &lt;.0001</code></pre>
</div>
</div>
</figure>
</div>
</section>
<section id="comprehension-questions" class="level2">
<h2 class="anchored" data-anchor-id="comprehension-questions">Comprehension Questions</h2>
<ol type="1">
<li>What is the purpose of using contrast coefficient lists instead of explicit mathematical expressions?</li>
<li>How can you construct a contrast coefficient list for a two-way ANOVA interaction term?</li>
<li>Given a factorial experiment with three factors (A, B, and C), describe how you would write a contrast coefficient list for an ABC interaction.</li>
<li>Consider a 3-level factor <span class="math inline">\(A\)</span> and a 4-level factor <span class="math inline">\(B\)</span>. How would the contrast coefficient list be structured for a linear trend in <span class="math inline">\(A\)</span>?</li>
<li>In an experiment with unequal sample sizes, how do contrast coefficients need to be adjusted to ensure equal variance for hypothesis testing?</li>
</ol>
</section>
<section id="detailed-solutions" class="level2">
<h2 class="anchored" data-anchor-id="detailed-solutions">Detailed Solutions</h2>
<ol type="1">
<li><p><strong>Purpose of Contrast Coefficient Lists</strong> Contrast coefficient lists provide a compact and systematic way to express hypotheses without writing out full mathematical expressions. They make it easier to program statistical software and quickly identify significant effects in factorial designs.</p></li>
<li><p><strong>Constructing an Interaction Contrast Coefficient List</strong> For a two-way interaction contrast in a <span class="math inline">\(2 \times 2\)</span> factorial experiment, we use the rule:</p></li>
</ol>
<p><span class="math display">\[
(\alpha\beta)_{11} - (\alpha\beta)_{12} - (\alpha\beta)_{21} + (\alpha\beta)_{22}.
\]</span></p>
<p>This corresponds to the coefficient list:</p>
<p><span class="math display">\[
[1, -1, -1, 1].
\]</span></p>
<ol start="3" type="1">
<li><strong>Contrast List for an ABC Interaction</strong> In a <span class="math inline">\(2^3\)</span> design, the ABC interaction contrast compares the effect of factors <span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span>, and <span class="math inline">\(C\)</span> together:</li>
</ol>
<p><span class="math display">\[
(ABC) = (Y_{111} - Y_{112} - Y_{121} + Y_{122} - Y_{211} + Y_{212} + Y_{221} - Y_{222}).
\]</span></p>
<p>The coefficient list is:</p>
<p><span class="math display">\[
[1, -1, -1, 1, -1, 1, 1, -1].
\]</span></p>
<ol start="4" type="1">
<li><strong>Contrast for a Linear Trend in <span class="math inline">\(A\)</span></strong> For a three-level factor <span class="math inline">\(A\)</span> (<span class="math inline">\(a = 3\)</span>), a linear trend contrast uses coefficients based on equal spacing:</li>
</ol>
<p><span class="math display">\[
[-1, 0, 1].
\]</span></p>
<p>If factor <span class="math inline">\(B\)</span> has four levels (<span class="math inline">\(b = 4\)</span>), we apply this contrast across all levels of <span class="math inline">\(B\)</span>, summing over <span class="math inline">\(B\)</span> for each level of <span class="math inline">\(A\)</span>.</p>
<ol start="5" type="1">
<li><strong>Adjusting Contrasts for Unequal Sample Sizes</strong> When sample sizes are unequal, the variance of each contrast estimate must be standardized. This is done by normalizing the contrast coefficients:</li>
</ol>
<p><span class="math display">\[
\frac{c_i}{\sqrt{\sum c_i^2 / n_i}}.
\]</span></p>
<p>This ensures that all contrasts have equal precision and are directly comparable.</p>
</section>
</section>
<section id="numerical-scaffolding" class="level1">
<h1>Numerical Scaffolding</h1>
<section id="step-by-step-computation" class="level2">
<h2 class="anchored" data-anchor-id="step-by-step-computation">Step-by-Step Computation</h2>
<ol type="1">
<li><strong>Cell Means</strong>:</li>
</ol>
<p><span class="math display">\[
\bar{Y}_{11\cdot} = \frac{32.1 + 33.3 + 31.9}{3} \approx 32.43,
   \quad
   \bar{Y}_{12\cdot} \approx 29.0,
   \quad
   \bar{Y}_{21\cdot} \approx 25.77,
   \quad
   \bar{Y}_{22\cdot} \approx 20.63.
\]</span></p>
<ol type="1">
<li><strong>ANOVA Sums of Squares</strong>:
<ul>
<li><strong>SST</strong>:</li>
</ul></li>
</ol>
<p><span class="math display">\[
\sum (y_{ijt} - \bar{Y}_{\cdot\cdot\cdot})^2.
\]</span></p>
<ul>
<li><strong>SSA</strong> (BatteryType), <strong>SSB</strong> (Brand), <strong>SSAB</strong> (interaction).</li>
</ul>
<ol type="1">
<li><strong>Error SS</strong>:</li>
</ol>
<p><span class="math display">\[
SS_{\text{Error}} = SS_{\text{Total}} - SS_A - SS_B - SS_{AB}.
\]</span></p>
<ol type="1">
<li><strong>Mean Squares</strong>:</li>
</ol>
<p><span class="math display">\[
MS_A = \frac{SS_A}{a-1},
     \quad MS_B = \frac{SS_B}{b-1},
     \quad MS_{AB} = \frac{SS_{AB}}{(a-1)(b-1)},
     \quad MS_{\text{Error}} = \frac{SS_{\text{Error}}}{n - ab}.
\]</span></p>
<p><em>(In a 2×2 design, <span class="math inline">\((a-1)(b-1) = 1\)</span>, so the interaction df is 1.)</em></p>
<ol type="1">
<li><strong>F-Ratios</strong>:</li>
</ol>
<p><span class="math display">\[
F_A = \frac{MS_A}{MS_{\text{Error}}},
   \quad F_B = \frac{MS_B}{MS_{\text{Error}}},
   \quad F_{AB} = \frac{MS_{AB}}{MS_{\text{Error}}}.
\]</span></p>
</section>
</section>
<section id="balanced-vs.-unbalanced-data" class="level1">
<h1>Balanced vs.&nbsp;Unbalanced Data</h1>
<section id="intuitive-understanding-1" class="level2">
<h2 class="anchored" data-anchor-id="intuitive-understanding-1">Intuitive Understanding</h2>
<p>In statistical modeling, especially in <strong>Analysis of Variance (ANOVA)</strong>, the concepts of <strong>balanced</strong> and <strong>unbalanced</strong> designs are fundamental:</p>
<ul>
<li><strong>Balanced Design:</strong> Each factor-level combination has the same number of observations, making calculations straightforward and allowing different sums of squares methods (Type I, II, III) to yield the same results.</li>
<li><strong>Unbalanced Design:</strong> Some factor levels have more observations than others, complicating interpretations and requiring careful choice of sums of squares to ensure valid comparisons.</li>
</ul>
<section id="why-does-balance-matter" class="level3">
<h3 class="anchored" data-anchor-id="why-does-balance-matter">Why does balance matter?</h3>
<ul>
<li>In a balanced design, <strong>main effects</strong> and <strong>interaction effects</strong> are easier to interpret because all levels contribute equally to variance.</li>
<li>In an unbalanced design, estimates depend on the order of factor entry in the model, leading to different results based on the sum of squares method used.</li>
</ul>
</section>
</section>
</section>
<section id="mathematical-foundations-of-sums-of-squares-ss" class="level1">
<h1>Mathematical Foundations of Sums of Squares (SS)</h1>
<section id="type-i-sequential-sums-of-squares" class="level2">
<h2 class="anchored" data-anchor-id="type-i-sequential-sums-of-squares">1. Type I (Sequential) Sums of Squares</h2>
<ul>
<li>Type I SS calculates the sum of squares <strong>sequentially</strong> based on the order in which factors are entered into the model.</li>
<li>Each factor’s effect is tested <strong>before adjusting for other factors</strong>.</li>
<li>The order of entry <strong>matters</strong>, meaning later factors are tested after accounting for earlier ones.</li>
</ul>
</section>
<section id="mathematical-formulation" class="level2">
<h2 class="anchored" data-anchor-id="mathematical-formulation">Mathematical Formulation</h2>
<p>For a model with two factors, <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>, and their interaction:</p>
<p><span class="math display">\[
SS_{\text{Type I}} = SS(A) + SS(B \mid A) + SS(A \times B \mid A, B)
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(SS(A)\)</span> tests the effect of A alone.</li>
<li><span class="math inline">\(SS(B \mid A)\)</span> tests B after accounting for A.</li>
<li><span class="math inline">\(SS(A \times B \mid A, B)\)</span> tests the interaction after both main effects.</li>
</ul>
<section id="when-to-use-type-i-ss" class="level3">
<h3 class="anchored" data-anchor-id="when-to-use-type-i-ss">When To Use Type I SS?</h3>
<ul>
<li><strong>For hierarchical models</strong> where the order of factor entry reflects natural causation.</li>
<li><strong>For regression models</strong> where variables are added in a meaningful sequence.</li>
<li><strong>For unbalanced data</strong>, use with caution—it is <strong>biased toward factors entered earlier</strong>.</li>
</ul>
</section>
</section>
<section id="type-ii-adjusted-sums-of-squares" class="level2">
<h2 class="anchored" data-anchor-id="type-ii-adjusted-sums-of-squares">2. Type II (Adjusted) Sums of Squares</h2>
<ul>
<li>Type II SS <strong>tests each main effect after accounting for all other main effects but without interactions</strong>.</li>
<li><strong>Assumes no interaction between factors</strong> when computing main effects.</li>
</ul>
</section>
<section id="mathematical-formulation-1" class="level2">
<h2 class="anchored" data-anchor-id="mathematical-formulation-1">Mathematical Formulation</h2>
<p><span class="math display">\[
SS_{\text{Type II}} = SS(A \mid B) + SS(B \mid A) + SS(A \times B \mid A, B)
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(SS(A \mid B)\)</span> tests A after controlling for B but <strong>ignores the interaction</strong>.</li>
<li><span class="math inline">\(SS(B \mid A)\)</span> tests B similarly.</li>
<li>The interaction term is tested last.</li>
</ul>
<section id="when-to-use-type-ii-ss" class="level3">
<h3 class="anchored" data-anchor-id="when-to-use-type-ii-ss">When To Use Type II SS?</h3>
<ul>
<li><strong>When interactions are not significant</strong> and main effects are of primary interest.</li>
<li><strong>For regression models</strong> where predictors are independent.</li>
<li><strong>For unbalanced designs</strong>, when interactions are weak.</li>
</ul>
</section>
</section>
<section id="type-iii-fully-adjusted-sums-of-squares" class="level2">
<h2 class="anchored" data-anchor-id="type-iii-fully-adjusted-sums-of-squares">3. Type III (Fully Adjusted) Sums of Squares</h2>
<ul>
<li>Type III SS <strong>adjusts for all other terms in the model, including interactions</strong>.</li>
<li>It tests each factor <strong>as if it were the last entered</strong>, making it the <strong>most interpretable for unbalanced designs</strong>.</li>
</ul>
</section>
<section id="mathematical-formulation-2" class="level2">
<h2 class="anchored" data-anchor-id="mathematical-formulation-2">Mathematical Formulation</h2>
<p><span class="math display">\[
SS_{\text{Type III}} = SS(A \mid B, A \times B) + SS(B \mid A, A \times B) + SS(A \times B \mid A, B)
\]</span></p>
<p>where:</p>
<ul>
<li>Each term is tested after <strong>controlling for all other effects, including interactions</strong>.</li>
</ul>
<section id="when-to-use-type-iii-ss" class="level3">
<h3 class="anchored" data-anchor-id="when-to-use-type-iii-ss">When To Use Type III SS?</h3>
<ul>
<li><strong>For unbalanced designs</strong> where fair comparisons between factors are needed.</li>
<li><strong>For factorial ANOVA models</strong> when interactions are present.</li>
<li><strong>For categorical variables</strong>, especially with contrasts like <code>contr.sum</code>.</li>
</ul>
</section>
</section>
</section>
<section id="r-implementation-computing-type-iii-ss-using-caranova" class="level1">
<h1>R Implementation: Computing Type III SS Using <code>car::Anova()</code></h1>
<p>To obtain <strong>Type III SS in R</strong>, we must ensure the correct contrasts are set:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set contrast options for Type III SS</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="st">"contr.sum"</span>, <span class="st">"contr.poly"</span>))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the ANOVA model</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(Response <span class="sc">~</span> FactorA <span class="sc">*</span> FactorB, <span class="at">data =</span> dataset)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute Type III SS using car::Anova()</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(model, <span class="at">type =</span> <span class="st">"III"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="alternative-approach-drop1-for-type-iii-ss" class="level2">
<h2 class="anchored" data-anchor-id="alternative-approach-drop1-for-type-iii-ss">Alternative Approach: <code>drop1()</code> for Type III SS</h2>
<p>Another way to obtain Type III SS in R is:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(model, <span class="sc">~</span>., <span class="at">test =</span> <span class="st">"F"</span>)  <span class="co"># Ensures Type III if contrasts are set correctly</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This method is <strong>equivalent</strong> to <code>car::Anova()</code> but requires contrast settings to be explicitly defined beforehand.</p>
</section>
<section id="comparison-of-sums-of-squares" class="level2">
<h2 class="anchored" data-anchor-id="comparison-of-sums-of-squares">Comparison Of Sums of Squares</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 20%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th>SS Type</th>
<th>Interpretation</th>
<th>Order Matters?</th>
<th>Best for Balanced?</th>
<th>Best for Unbalanced?</th>
<th>Interaction Handling</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Type I</td>
<td>Sequential</td>
<td><strong>Yes</strong></td>
<td><strong>Yes</strong></td>
<td>No</td>
<td>Ignored at earlier levels</td>
</tr>
<tr class="even">
<td>Type II</td>
<td>Adjusted (main effects only)</td>
<td>No</td>
<td><strong>Yes</strong></td>
<td><strong>Some cases</strong></td>
<td>Ignores interactions</td>
</tr>
<tr class="odd">
<td>Type III</td>
<td>Fully adjusted</td>
<td>No</td>
<td>Yes</td>
<td><strong>Yes</strong> (preferred)</td>
<td>Always accounts for interactions</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="comprehension-questions-appendix" class="level1">
<h1>Comprehension Questions (Appendix)</h1>
<section id="conceptual-questions" class="level2">
<h2 class="anchored" data-anchor-id="conceptual-questions">Conceptual Questions</h2>
<ol type="1">
<li><strong>Why do Type I, II, and III sums of squares give different results in unbalanced designs?</strong></li>
<li><strong>When would you use Type II over Type III SS?</strong></li>
<li><strong>What happens if interaction terms are ignored in an unbalanced ANOVA?</strong></li>
<li><strong>Why is Type III SS preferred for interpreting main effects in unbalanced designs?</strong></li>
<li><strong>How does contrast coding (<code>contr.treatment</code> vs <code>contr.sum</code>) affect Type III SS calculations?</strong></li>
</ol>
</section>
<section id="computational-questions" class="level2">
<h2 class="anchored" data-anchor-id="computational-questions">Computational Questions</h2>
<ol type="1">
<li><p><strong>Given the dataset below, determine if it is balanced:</strong></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>FactorA  FactorB  Response</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>A1       B1       <span class="dv">10</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>A1       B1       <span class="dv">12</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>A1       B2       <span class="dv">15</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>A2       B1       <span class="dv">9</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>A2       B2       <span class="dv">11</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>A2       B2       <span class="dv">14</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Is the dataset balanced? Compute Type III SS using <code>car::Anova()</code>.</p></li>
<li><p><strong>Simulate an unbalanced dataset and fit a two-way ANOVA. Compute Type I, II, and III SS in R.</strong></p></li>
<li><p><strong>Interpret the differences between Type I, II, and III SS in a factorial ANOVA.</strong></p></li>
<li><p><strong>Modify contrast settings in R and observe their effect on Type III SS.</strong></p></li>
<li><p><strong>Explain why <code>drop1()</code> and <code>car::Anova()</code> may give different results if contrasts are not set correctly.</strong></p></li>
</ol>
</section>
<section id="detailed-solutions-1" class="level2">
<h2 class="anchored" data-anchor-id="detailed-solutions-1">Detailed Solutions</h2>
<ol type="1">
<li><strong>Dataset Balance Check</strong>
<ul>
<li>The dataset is unbalanced since the number of observations per condition is unequal.</li>
<li>Compute Type III SS:</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(Response <span class="sc">~</span> FactorA <span class="sc">*</span> FactorB, <span class="at">data =</span> dataset)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(model, <span class="at">type =</span> <span class="st">"III"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><strong>Simulating Unbalanced Data and Computing SS</strong></li>
</ol>
<div id="tbl-sim-unbalanced-data" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sim-unbalanced-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6: Simulating Unbalanced Data and Computing SS
</figcaption>
<div aria-describedby="tbl-sim-unbalanced-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the seed for reproducibility</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the levels for each factor</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>factor_A <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A1"</span>, <span class="st">"A2"</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>factor_B <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"B1"</span>, <span class="st">"B2"</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with the factor combinations</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">A =</span> factor_A, <span class="at">B =</span> factor_B)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeat each combination 100 times</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df), <span class="at">each =</span> <span class="dv">50</span>), ]</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Introduce imbalance by removing some samples from one of the factor combinations</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span>  </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(A <span class="sc">==</span> <span class="st">"A1"</span> <span class="sc">&amp;</span> B <span class="sc">==</span> <span class="st">"B2"</span>)) <span class="sc">|&gt;</span>  </span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(df <span class="sc">|&gt;</span>  <span class="fu">filter</span>(A <span class="sc">==</span> <span class="st">"A1"</span> <span class="sc">&amp;</span> B <span class="sc">==</span> <span class="st">"B2"</span>) <span class="sc">|&gt;</span>  <span class="fu">sample_n</span>(<span class="dv">50</span>))</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Add some response variable (e.g., continuous or categorical)</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>response <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(df))</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the first few rows of the data frame</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df <span class="sc">|&gt;</span>  <span class="fu">head</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     A  B   response
1   A1 B1 -0.6089264
1.1 A1 B1  0.5049551
1.2 A1 B1 -1.7170087
1.3 A1 B1 -0.7844590
1.4 A1 B1 -0.8509076
1.5 A1 B1 -2.4142076</code></pre>
</div>
</div>
</figure>
</div>
<div id="tbl-unbalanced-ss" class="cell anchored">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(response <span class="sc">~</span> A <span class="sc">*</span> B, <span class="at">data =</span> df)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">Anova</span>(model, <span class="at">type =</span> <span class="st">"III"</span>) <span class="co"># Type III SS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Sum Sq</th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">F value</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">0.0122168</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0139678</td>
<td style="text-align: right;">0.9060417</td>
</tr>
<tr class="even">
<td style="text-align: left;">A</td>
<td style="text-align: right;">0.4909088</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.5612696</td>
<td style="text-align: right;">0.4546473</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B</td>
<td style="text-align: right;">0.0966028</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.1104487</td>
<td style="text-align: right;">0.7399890</td>
</tr>
<tr class="even">
<td style="text-align: left;">A:B</td>
<td style="text-align: right;">0.5338829</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.6104030</td>
<td style="text-align: right;">0.4355788</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Residuals</td>
<td style="text-align: right;">171.4294367</td>
<td style="text-align: right;">196</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(model, <span class="sc">~</span>., <span class="at">test =</span> <span class="st">"F"</span>) <span class="co"># Type III SS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Sum of Sq</th>
<th style="text-align: right;">RSS</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">F value</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><none></none></td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">171.4294</td>
<td style="text-align: right;">-22.82913</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">A</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.4909088</td>
<td style="text-align: right;">171.9203</td>
<td style="text-align: right;">-24.25722</td>
<td style="text-align: right;">0.5612696</td>
<td style="text-align: right;">0.4546473</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0966028</td>
<td style="text-align: right;">171.5260</td>
<td style="text-align: right;">-24.71646</td>
<td style="text-align: right;">0.1104487</td>
<td style="text-align: right;">0.7399890</td>
</tr>
<tr class="even">
<td style="text-align: left;">A:B</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.5338829</td>
<td style="text-align: right;">171.9633</td>
<td style="text-align: right;">-24.20723</td>
<td style="text-align: right;">0.6104030</td>
<td style="text-align: right;">0.4355788</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Sum Sq</th>
<th style="text-align: right;">Mean Sq</th>
<th style="text-align: right;">F value</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0677010</td>
<td style="text-align: right;">0.0677010</td>
<td style="text-align: right;">0.0774045</td>
<td style="text-align: right;">0.7811394</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0847516</td>
<td style="text-align: right;">0.0847516</td>
<td style="text-align: right;">0.0968988</td>
<td style="text-align: right;">0.7559143</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A:B</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.5338829</td>
<td style="text-align: right;">0.5338829</td>
<td style="text-align: right;">0.6104030</td>
<td style="text-align: right;">0.4355788</td>
</tr>
<tr class="even">
<td style="text-align: left;">Residuals</td>
<td style="text-align: right;">196</td>
<td style="text-align: right;">171.4294367</td>
<td style="text-align: right;">0.8746400</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<ol start="3" type="1">
<li><strong>Interpreting SS Differences</strong>
<ul>
<li>Type I results will <strong>change</strong> based on factor order.</li>
<li>Type II ignores interactions.</li>
<li>Type III ensures fair comparisons.</li>
</ul></li>
</ol>
</section>
<section id="conclusion-2" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-2">Conclusion</h2>
<ul>
<li><strong>Use Type I</strong> for hierarchical models where order matters.</li>
<li><strong>Use Type II</strong> when interactions are <strong>not</strong> of primary interest.</li>
<li><strong>Use Type III</strong> for <strong>unbalanced designs</strong> or when interactions exist.</li>
</ul>
<p>By setting <strong>contrasts correctly</strong>, <code>car::Anova()</code> ensures <strong>valid Type III SS computations</strong>, making comparisons fair in real-world ANOVA applications.</p>
</section>
</section>
<section id="extended-example-interpretation" class="level1">
<h1>Extended Example Interpretation</h1>
<section id="if-interaction-is-significant" class="level2">
<h2 class="anchored" data-anchor-id="if-interaction-is-significant">If Interaction is Significant</h2>
<p>Given the battery example suggests a significant interaction, do the following:</p>
<ol type="1">
<li><strong>Cell Mean Comparison</strong>: Use <code>emmeans(model_full, ~ BatteryType:Brand)</code> and pairwise tests.</li>
<li><strong>Interpret</strong> if brand difference is larger for Alkaline vs.&nbsp;Heavy Duty, or if battery type difference is larger for one brand.</li>
<li>Possibly produce an <strong>interaction plot</strong> to visualize how lines cross or deviate from parallel.</li>
</ol>
</section>
<section id="if-interaction-was-non-significant" class="level2">
<h2 class="anchored" data-anchor-id="if-interaction-was-non-significant">If Interaction Was Non-Significant</h2>
<ul>
<li>Refit a simpler model: <code>model_main &lt;- aov(Life ~ BatteryType + Brand, data=battery_data)</code>.</li>
<li>Compare main effects of BatteryType, Brand with <code>TukeyHSD</code> or <code>emmeans</code>.</li>
</ul>
</section>
<section id="practical-implementation-tips" class="level2">
<h2 class="anchored" data-anchor-id="practical-implementation-tips">Practical Implementation Tips</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interaction EMM</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>emm_inter <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(model_full, <span class="sc">~</span> BatteryType<span class="sc">:</span>Brand)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(emm_inter, <span class="at">adjust=</span><span class="st">"tukey"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                                   estimate    SE df t.ratio p.value
 Alkaline NameBrand - HeavyDuty NameBrand       6.67 0.401  8  16.638  &lt;.0001
 Alkaline NameBrand - Alkaline StoreBrand       3.40 0.401  8   8.485  0.0001
 Alkaline NameBrand - HeavyDuty StoreBrand     11.80 0.401  8  29.449  &lt;.0001
 HeavyDuty NameBrand - Alkaline StoreBrand     -3.27 0.401  8  -8.153  0.0002
 HeavyDuty NameBrand - HeavyDuty StoreBrand     5.13 0.401  8  12.811  &lt;.0001
 Alkaline StoreBrand - HeavyDuty StoreBrand     8.40 0.401  8  20.964  &lt;.0001

P value adjustment: tukey method for comparing a family of 4 estimates </code></pre>
</div>
</div>
<ol type="1">
<li><strong>Always test</strong> for interaction first.</li>
<li>If <span class="math inline">\(p &lt; \alpha\)</span> for interaction: do not rely on main-effect means.</li>
<li><strong>Use <code>emmeans</code></strong> for user-friendly post hoc analysis:
<ul>
<li><code>pairs(emm_inter, adjust="tukey")</code> for pairwise comparisons.</li>
<li><code>contrast(emm_inter, list(...))</code> for custom contrasts.</li>
</ul></li>
<li><strong>Diagnostic plots</strong> are crucial to validate assumptions.</li>
<li><strong>Unbalanced data</strong>: consider Type III SS for interpretative parity.</li>
<li><strong>Interaction plots</strong> can help visualize the interaction effect.</li>
<li><strong>Custom contrasts</strong> can be useful for specific comparisons.</li>
</ol>
</section>
</section>
<section id="final-knowledge-checks" class="level1">
<h1>Final Knowledge Checks</h1>
<section id="knowledge-check-1" class="level2 quiz-question">
<h2 class="quiz-question anchored" data-anchor-id="knowledge-check-1">Knowledge Check 1</h2>
<p>Which is <strong>NOT</strong> a typical step in factorial ANOVA?</p>
<ul>
<li><span data-explanation="Yes, we typically do this initially.">(A): Fit the full model with interaction.</span></li>
<li><span data-explanation="Yes, that is the usual approach.">(B): Test interaction first.</span></li>
<li><span class="correct" data-explanation="Incorrect approach. We do NOT drop it without testing if it might be significant.">(C): Immediately drop the interaction term without testing.</span></li>
<li><span data-explanation="Yes, we do that after model significance.">(D): Use post hoc comparisons if needed.</span></li>
</ul>
</section>
<section id="knowledge-check-2-interpreting-emmeans-output" class="level2 quiz-question">
<h2 class="quiz-question anchored" data-anchor-id="knowledge-check-2-interpreting-emmeans-output">Knowledge Check 2: Interpreting <code>emmeans</code> Output</h2>
<p><strong>Suppose</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(model_full, <span class="sc">~</span> BatteryType<span class="sc">:</span>Brand)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> BatteryType Brand      emmean    SE df lower.CL upper.CL
 Alkaline    NameBrand    32.4 0.283  8     31.8     33.1
 HeavyDuty   NameBrand    25.8 0.283  8     25.1     26.4
 Alkaline    StoreBrand   29.0 0.283  8     28.4     29.7
 HeavyDuty   StoreBrand   20.6 0.283  8     20.0     21.3

Confidence level used: 0.95 </code></pre>
</div>
</div>
</section>
<section id="which-statement-is-correct" class="level2 quiz-question">
<h2 class="quiz-question anchored" data-anchor-id="which-statement-is-correct">Which statement is correct?</h2>
<ul>
<li><span data-explanation="True math, yes.">(A): The difference between “Alkaline:NameBrand” and “HeavyDuty:NameBrand” is roughly <span class="math inline">\(32.43 - 25.77 = 6.66\)</span>.</span></li>
<li><span data-explanation="Yes, from the table.">(B): The confidence interval for “Alkaline:NameBrand” is from 31.01 to 33.85 hours.</span></li>
<li><span data-explanation="True.">(C): If lines in the interaction plot cross, it suggests a significant interaction.</span></li>
<li><span class="correct" data-explanation="Yes, all statements are correct.">(D): All are correct.</span></li>
</ul>
</section>
</section>
<section id="conclusion-3" class="level1">
<h1>Conclusion</h1>
<section id="key-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="key-takeaways">Key Takeaways</h2>
<ol type="1">
<li><strong>Two-way factorial ANOVA</strong> reveals how two factors (and their interaction) influence a response.</li>
<li><strong>Interaction significance</strong> → interpret treatment combinations rather than factor main effects alone.</li>
<li><strong>Model assumptions</strong>—normality, constant variance, independence—are essential.</li>
<li><strong><code>emmeans</code></strong> provides a robust way for post hoc comparisons, confidence intervals, and custom contrasts.</li>
<li><strong>Unbalanced data</strong> requires care with sums of squares (Type III often recommended for interpretative parity).</li>
</ol>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>In this presentation, we:</p>
<ol type="1">
<li>Defined the <strong>two-way complete model</strong> and explained <strong>interaction</strong> using established literature (Fisher, Dean et al.).</li>
<li>Showed <strong>R code</strong> to fit the model and interpret results (<code>aov</code>, <code>emmeans</code>).</li>
<li>Discussed <strong>diagnostic checks</strong> and the importance of verifying assumptions.</li>
<li>Addressed <strong>unbalanced</strong> designs and the difference between <strong>Type I</strong> vs.&nbsp;<strong>Type III</strong> SS.</li>
<li>Used a <strong>numerical example</strong> (battery life) to illustrate analysis flow.</li>
</ol>
</section>
<section id="references" class="level2">




</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-christensen2018" class="csl-entry" role="listitem">
Christensen, R. (2018). <em>Analysis of variance, design, and regression: Linear modeling for unbalanced data</em> (2nd ed.). <span>Chapman and Hall/CRC</span>.
</div>
<div id="ref-dean2017" class="csl-entry" role="listitem">
Dean, A., Voss, D., &amp; Draguljić, D. (2017). <em>Design and analysis of experiments</em> (2nd ed.). Springer International Publishing. <a href="https://doi.org/10.1007/978-3-319-52250-0">https://doi.org/10.1007/978-3-319-52250-0</a>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/Data-Wise\.github\.io\/doe\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>